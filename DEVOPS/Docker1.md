# üê≥ DOCKER: N·∫ÆM V·ªÆNG N·ªÄN T·∫¢NG

- [üê≥ DOCKER: N·∫ÆM V·ªÆNG N·ªÄN T·∫¢NG](#-docker-n·∫Øm-v·ªØng-n·ªÅn-t·∫£ng)
  - [üéØ M·ª•c Ti√™u T·ªïng Qu√°t](#-m·ª•c-ti√™u-t·ªïng-qu√°t)
  - [üéØ M·ª•c Ti√™u](#-m·ª•c-ti√™u)
  - [1. üåü Gi·ªõi Thi·ªáu](#1--gi·ªõi-thi·ªáu)
    - [V·∫•n ƒë·ªÅ "It works on my machine!"](#v·∫•n-ƒë·ªÅ-it-works-on-my-machine)
    - [Gi·∫£i ph√°p l√† g√¨? VMs vs Containers](#gi·∫£i-ph√°p-l√†-g√¨-vms-vs-containers)
  - [2. üêß Linux C∆° B·∫£n Cho Docker](#2--linux-c∆°-b·∫£n-cho-docker)
    - [Di chuy·ªÉn \& Qu·∫£n l√Ω file/th∆∞ m·ª•c](#di-chuy·ªÉn--qu·∫£n-l√Ω-fileth∆∞-m·ª•c)
    - [Quy·ªÅn (Permissions) c∆° b·∫£n](#quy·ªÅn-permissions-c∆°-b·∫£n)
    - [M·ªôt s·ªë l·ªánh h·ªØu √≠ch kh√°c](#m·ªôt-s·ªë-l·ªánh-h·ªØu-√≠ch-kh√°c)
  - [3. üí° Docker Core Concepts](#3--docker-core-concepts)
    - [Docker Engine](#docker-engine)
    - [Image](#image)
    - [Container](#container)
    - [Dockerfile](#dockerfile)
    - [Registry (Docker Hub)](#registry-docker-hub)
  - [4. ‚öôÔ∏è Docker CLI C∆° B·∫£n](#4-Ô∏è-docker-cli-c∆°-b·∫£n)
    - [Qu·∫£n l√Ω Images](#qu·∫£n-l√Ω-images)
    - [Qu·∫£n l√Ω Containers](#qu·∫£n-l√Ω-containers)
    - [T∆∞∆°ng t√°c v·ªõi Container](#t∆∞∆°ng-t√°c-v·ªõi-container)
  - [5. üìù Dockerfile: C√¥ng Th·ª©c T·∫°o Image](#5--dockerfile-c√¥ng-th·ª©c-t·∫°o-image)
    - [C√°c ch·ªâ th·ªã (Instructions) ph·ªï bi·∫øn](#c√°c-ch·ªâ-th·ªã-instructions-ph·ªï-bi·∫øn)
    - [V√≠ d·ª• Dockerfile ƒë∆°n gi·∫£n (Node.js App)](#v√≠-d·ª•-dockerfile-ƒë∆°n-gi·∫£n-nodejs-app)
  - [6. üõ†Ô∏è Th·ª±c H√†nh: Dockerize ·ª®ng D·ª•ng "Hello World" v·ªõi Nginx](#6-Ô∏è-th·ª±c-h√†nh-dockerize-·ª©ng-d·ª•ng-hello-world-v·ªõi-nginx)
  - [7. üèãÔ∏è B√†i T·∫≠p](#7-Ô∏è-b√†i-t·∫≠p)

---

## üéØ M·ª•c Ti√™u T·ªïng Qu√°t

- Hi·ªÉu r√µ **Docker** v√† **Docker Compose** l√† g√¨, t·∫°i sao ch√∫ng quan tr·ªçng trong ph√°t tri·ªÉn ph·∫ßn m·ªÅm hi·ªán ƒë·∫°i.
- N·∫Øm v·ªØng c√°c **kh√°i ni·ªám c·ªët l√µi** v√† **l·ªánh Docker c∆° b·∫£n**.
- Bi·∫øt c√°ch **Dockerize** m·ªôt ·ª©ng d·ª•ng ƒë∆°n gi·∫£n.
- S·ª≠ d·ª•ng **Docker Compose** ƒë·ªÉ qu·∫£n l√Ω c√°c ·ª©ng d·ª•ng ƒëa-container.
- L√†m quen v·ªõi c√°c **l·ªánh Linux c∆° b·∫£n** th∆∞·ªùng d√πng khi l√†m vi·ªác v·ªõi Docker.
- T·ª± tin √°p d·ª•ng Docker v√†o **workflow ph√°t tri·ªÉn h√†ng ng√†y** ƒë·ªÉ tƒÉng hi·ªáu su·∫•t v√† t√≠nh nh·∫•t qu√°n.

---

## üéØ M·ª•c Ti√™u

- Hi·ªÉu ƒë∆∞·ª£c v·∫•n ƒë·ªÅ Docker gi·∫£i quy·∫øt (**"It works on my machine!"**).
- N·∫Øm v·ªØng c√°c kh√°i ni·ªám: `Image`, `Container`, `Dockerfile`, `Registry`.
- Th√†nh th·∫°o c√°c l·ªánh `Docker CLI` c∆° b·∫£n.
- L√†m quen v·ªõi c√°c l·ªánh `Linux` c∆° b·∫£n c·∫ßn thi·∫øt khi l√†m vi·ªác v·ªõi Docker.
- Th·ª±c h√†nh x√¢y d·ª±ng `Dockerfile` ƒë·∫ßu ti√™n v√† ch·∫°y `container`.

---

## 1. üåü Gi·ªõi Thi·ªáu

### V·∫•n ƒë·ªÅ "It works on my machine!"

- M√¥i tr∆∞·ªùng kh√°c nhau gi·ªØa dev, staging, production.
- Xung ƒë·ªôt th∆∞ vi·ªán, phi√™n b·∫£n ph·∫ßn m·ªÅm.
- Kh√≥ khƒÉn khi setup m√¥i tr∆∞·ªùng cho ng∆∞·ªùi m·ªõi.

[H√¨nh ·∫£nh minh h·ªça: meme "works on my machine"](../images/devops/itworksonmymachine.webp)

### Gi·∫£i ph√°p l√† g√¨? VMs vs Containers

| T√≠nh nƒÉng        | Virtual Machines (VMs)                                   | Containers (Docker)                             |
| :--------------- | :------------------------------------------------------- | :---------------------------------------------- |
| **Isolation**    | OS Level (m·ªói VM c√≥ Kernel ri√™ng)                        | Process Level (chia s·∫ª Kernel c·ªßa Host OS)      |
| **Overhead**     | Cao (RAM, CPU, Disk cho c·∫£ OS kh√°ch)                     | Th·∫•p (ch·ªâ t√†i nguy√™n cho ·ª©ng d·ª•ng)              |
| **Startup Time** | Ch·∫≠m (ph√∫t)                                              | Nhanh (gi√¢y)                                    |
| **Portability**  | Kh√° (image VM l·ªõn)                                       | R·∫•t cao (image container nh·ªè g·ªçn)               |
| **Density**      | Th·∫•p (√≠t VM tr√™n m·ªôt host)                               | Cao (nhi·ªÅu container tr√™n m·ªôt host)             |
| **Use Case**     | C·∫ßn OS kh√°c ho√†n to√†n, y√™u c·∫ßu b·∫£o m·∫≠t kernel ri√™ng bi·ªát | ƒê√≥ng g√≥i v√† ch·∫°y ·ª©ng d·ª•ng, microservices, CI/CD |

**S∆° ƒë·ªì ki·∫øn tr√∫c:**

```text
      App A | App B             App A | App B | App C
      Bins/Libs | Bins/Libs     Bins/Libs | Bins/Libs | Bins/Libs
      Guest OS | Guest OS       ---------------------
      Hypervisor                Container Engine (Docker)
      ---------------------     ---------------------
      Host OS                   Host OS
      ---------------------     ---------------------
      Infrastructure            Infrastructure

      (VM Architecture)         (Container Architecture)
```

Docker l√† m·ªôt n·ªÅn t·∫£ng **containerization** gi√∫p ƒë√≥ng g√≥i ·ª©ng d·ª•ng v√† c√°c dependencies c·ªßa n√≥ th√†nh m·ªôt ƒë∆°n v·ªã g·ªçi l√† **container**.

## 2. üêß Linux C∆° B·∫£n Cho Docker

Nhi·ªÅu `Docker image` ƒë∆∞·ª£c x√¢y d·ª±ng d·ª±a tr√™n Linux. Hi·ªÉu m·ªôt s·ªë l·ªánh c∆° b·∫£n gi√∫p b·∫°n t∆∞∆°ng t√°c v·ªõi `container` v√† vi·∫øt `Dockerfile` hi·ªáu qu·∫£ h∆°n.

### Di chuy·ªÉn & Qu·∫£n l√Ω file/th∆∞ m·ª•c

- `pwd` (print working directory): Hi·ªÉn th·ªã th∆∞ m·ª•c hi·ªán t·∫°i.
- `ls` (list): Li·ªát k√™ file v√† th∆∞ m·ª•c.
  - `ls -l`: Hi·ªÉn th·ªã chi ti·∫øt.
  - `ls -a`: Hi·ªÉn th·ªã c·∫£ file ·∫©n.
- `cd <directory>` (change directory): Chuy·ªÉn th∆∞ m·ª•c.
  - `cd ..`: L√™n th∆∞ m·ª•c cha.
  - `cd ~` ho·∫∑c `cd`: V·ªÅ th∆∞ m·ª•c home.
- `mkdir <directory_name>` (make directory): T·∫°o th∆∞ m·ª•c m·ªõi.
- `rm <file_name>` (remove): X√≥a file.
  - `rm -r <directory_name>`: X√≥a th∆∞ m·ª•c v√† n·ªôi dung b√™n trong (c·∫©n th·∫≠n!).
  - `rm -rf <directory_name>`: X√≥a th∆∞ m·ª•c v√† n·ªôi dung b√™n trong, kh√¥ng h·ªèi (R·∫§T C·∫®N TH·∫¨N!).
- `cp <source> <destination>` (copy): Sao ch√©p file ho·∫∑c th∆∞ m·ª•c.
  - `cp -r <source_dir> <destination_dir>`: Sao ch√©p th∆∞ m·ª•c.
- `mv <source> <destination>` (move): Di chuy·ªÉn ho·∫∑c ƒë·ªïi t√™n file/th∆∞ m·ª•c.

### Quy·ªÅn (Permissions) c∆° b·∫£n

- L·ªánh `ls -l` s·∫Ω hi·ªÉn th·ªã quy·ªÅn d·∫°ng `-rwxr-xr--`.
- `chmod <permissions> <file/directory>`: Thay ƒë·ªïi quy·ªÅn.
  - V√≠ d·ª•: `chmod +x script.sh` (th√™m quy·ªÅn execute cho file script).
  - V√≠ d·ª•: `chmod 755 data_folder` (set quy·ªÅn rwxr-xr-x).

### M·ªôt s·ªë l·ªánh h·ªØu √≠ch kh√°c

- `cat <file_name>`: Xem n·ªôi dung file.
- `echo "text"`: In text ra m√†n h√¨nh.
  - `echo "text" > file.txt`: Ghi text v√†o file (ghi ƒë√®).
  - `echo "text" >> file.txt`: Ghi text v√†o cu·ªëi file (append).
- `grep "pattern" <file_name>`: T√¨m ki·∫øm text trong file.
- `find <directory> -name "<pattern>"`: T√¨m ki·∫øm file/th∆∞ m·ª•c.
- `apt update` / `apt install <package>` (Debian/Ubuntu) ho·∫∑c `yum update` / `yum install <package>` (CentOS/RHEL): Qu·∫£n l√Ω package (th∆∞·ªùng d√πng trong `Dockerfile`).

## 3. üí° Docker Core Concepts

```text
+----------------------+                         +------------------------------------------------------+                         +-----------------------+
|                      |                         |                    DOCKER HOST                       |                         |                       |
|    DOCKER CLIENT     |------------------------>|  +-----------------------------------------------+   |<------------------------|       REGISTRY        |
|  (e.g., `docker` CLI)|  1. L·ªánh t·ª´ ng∆∞·ªùi d√πng  |  |                 Docker Daemon                 |   |  3. Pull/Push Images    |  (e.g., Docker Hub,   |
|                      |  (build, run, pull,     |  |                   (`dockerd`)                 |   |                         |  AWS ECR, Google GCR) |
|                      |   push, ps, etc.)       |  |       (L·∫Øng nghe API, Qu·∫£n l√Ω Objects)        |   |                         |                       |
+----------------------+                         |  +---------------------‚ñ≤--‚î¨----------------------+   |                         +-----------------------+
                                                 |                        |  |                          |
                                                 |     (T·∫£i/L∆∞u Images)   |  | 2. T·∫°o/Ch·∫°y/Qu·∫£n l√Ω      |
                                                 |                        |  |    Containers t·ª´ Images  |
                                                 |                        |  |    Build Images t·ª´       |
                                                 |                        |  |    Dockerfile            |
                                                 |                        |  |                          |
                                                 |  +---------------------‚î¥--‚ñº----------------------+   |
                                                 |  |       IMAGES          |       CONTAINERS      |   |
                                                 |  | (Templates Read-Only) | (Running Instances)   |   |
                                                 |  |  - ubuntu:latest      |  - my_app_container   |   |
                                                 |  |  - nginx:alpine       |  - db_container       |   |
                                                 |  |  - my_custom_app:v1   |  - ...                |   |
                                                 |  +-----------------------+-----------------------+   |
                                                 +------------------------------------------------------+

```

### Docker Engine

```text
  +-----------------+      +-----------------+      +-------------------------+
  |   Ng∆∞·ªùi d√πng    |----->|   Docker CLI    |----->|        REST API         |<---+
  +-----------------+      |   (`docker`)    |      +-------------------------+    |
                           +-----------------+                                     |
                                                                                   |
                                +--------------------------------------------------+
                                |                 Docker Daemon                    |
                                |                 (`dockerd`) üß†                   |
                                |  - L·∫Øng nghe API requests                        |
                                |  - Qu·∫£n l√Ω Images, Containers, Networks, Volumes |
                                +--------------------------------------------------+
```

- **Docker Daemon (`dockerd`)**:
  - "B·ªô n√£o" üß† c·ªßa Docker.
  - Ch·∫°y ng·∫ßm tr√™n m√°y ch·ªß.
  - L·∫Øng nghe c√°c y√™u c·∫ßu t·ª´ Docker API.
  - Ch·ªãu tr√°ch nhi·ªám qu·∫£n l√Ω c√°c ƒë·ªëi t∆∞·ª£ng Docker nh∆∞ images, containers, networks, v√† volumes.
- **REST API**:
  - M·ªôt giao di·ªán (interface) m√† c√°c ch∆∞∆°ng tr√¨nh c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë·ªÉ "n√≥i chuy·ªán" v·ªõi Daemon.
  - Docker CLI s·ª≠ d·ª•ng API n√†y ƒë·ªÉ g·ª≠i l·ªánh.
- **Docker CLI (`docker`)**:
  - C√¥ng c·ª• d√≤ng l·ªánh (Command Line Interface) cho ng∆∞·ªùi d√πng.
  - B·∫°n g√µ l·ªánh `docker run`, `docker ps`, v.v., v√† CLI s·∫Ω g·ª≠i y√™u c·∫ßu t∆∞∆°ng ·ª©ng ƒë·∫øn Daemon th√¥ng qua REST API.

### Image

- L√† m·ªôt **template read-only** (ch·ªâ ƒë·ªçc), gi·ªëng nh∆∞ m·ªôt b·∫£n thi·∫øt k·∫ø ho·∫∑c m·ªôt khu√¥n m·∫´u ƒë·ªÉ t·∫°o container.
- Ch·ª©a m·ªçi th·ª© c·∫ßn thi·∫øt ƒë·ªÉ ch·∫°y m·ªôt ·ª©ng d·ª•ng: m√£ ngu·ªìn, m·ªôt runtime, th∆∞ vi·ªán, bi·∫øn m√¥i tr∆∞·ªùng, v√† file c·∫•u h√¨nh.
- Gi·ªëng nh∆∞ m·ªôt "snapshot" üì∏ c·ªßa m·ªôt h·ªá th·ªëng file thu nh·ªè.
- Images ƒë∆∞·ª£c x√¢y d·ª±ng theo **l·ªõp (layers)**. M·ªói l·ªánh trong Dockerfile t·∫°o ra m·ªôt l·ªõp m·ªõi.
  - **V√≠ d·ª• v·ªÅ Layers:**

```text
+------------------------------------+  Layer 3 (·ª®ng d·ª•ng c·ªßa b·∫°n)
|         your_app_code              |
+------------------------------------+
|              nginx                 |  Layer 2 (Th√™m Nginx)
+------------------------------------+
|              ubuntu                |  Layer 1 (Base Image)
+------------------------------------+
==> Final Image (ubuntu + nginx + your_app_code)
```

- L·ª£i √≠ch c·ªßa layers:
  - **T√°i s·ª≠ d·ª•ng**: C√°c l·ªõp chung (nh∆∞ `ubuntu`) c√≥ th·ªÉ ƒë∆∞·ª£c chia s·∫ª gi·ªØa nhi·ªÅu image.
  - **T·ªëi ∆∞u l∆∞u tr·ªØ**: Ch·ªâ l∆∞u tr·ªØ ph·∫ßn thay ƒë·ªïi ·ªü m·ªói l·ªõp.
  - **T·ªëc ƒë·ªô build nhanh h∆°n**: Docker cache l·∫°i c√°c l·ªõp kh√¥ng thay ƒë·ªïi.

### Container

- L√† m·ªôt **phi√™n b·∫£n ch·∫°y (runnable instance)** c·ªßa m·ªôt Image.
- Khi b·∫°n "ch·∫°y" m·ªôt Image, b·∫°n t·∫°o ra m·ªôt Container.
- B·∫°n c√≥ th·ªÉ t·∫°o, kh·ªüi ƒë·ªông, d·ª´ng, di chuy·ªÉn, v√† x√≥a Containers.
- M·ªói Container l√† m·ªôt m√¥i tr∆∞·ªùng **isolated** (c√¥ l·∫≠p):

  - N√≥ c√≥ h·ªá th·ªëng file, process, network ri√™ng.
  - C√¥ l·∫≠p v·ªõi c√°c Containers kh√°c v√† v·ªõi m√°y ch·ªß (host machine).
  - Tuy nhi√™n, t·∫•t c·∫£ Containers tr√™n c√πng m·ªôt host **chia s·∫ª kernel c·ªßa host**.

- **So s√°nh d·ªÖ hi·ªÉu:**
  - **Image** gi·ªëng nh∆∞ m·ªôt `Class` trong l·∫≠p tr√¨nh h∆∞·ªõng ƒë·ªëi t∆∞·ª£ng.
  - **Container** gi·ªëng nh∆∞ m·ªôt `Object` (th·ªÉ hi·ªán c·ª• th·ªÉ) c·ªßa `Class` ƒë√≥.

```text
+-----------------------+         +-----------------------+
|     Image: my_app     |         |     Image: database   |
|  (Template Read-Only) |         |  (Template Read-Only) |
+-----------------------+         +-----------------------+
          |                                  |
          | .------------ ch·∫°y ------------. |
          V                                  V
+-----------------------+         +-----------------------+
|  Container A (my_app) |         | Container B (database)|
| (Isolated Environment)|         | (Isolated Environment)|
+-----------------------+         +-----------------------+

Tr√™n c√πng m·ªôt Host Machine (chia s·∫ª Kernel)
```

### Dockerfile

- L√† m·ªôt **file text** ƒë∆°n gi·∫£n, kh√¥ng c√≥ ph·∫ßn m·ªü r·ªông (nh∆∞ng th∆∞·ªùng ƒë·∫∑t t√™n l√† `Dockerfile`).
- Ch·ª©a m·ªôt chu·ªói c√°c **instructions** (ch·ªâ d·∫´n) ƒë·ªÉ Docker Engine t·ª± ƒë·ªông **build** (x√¢y d·ª±ng) m·ªôt Image.
- Gi·ªëng nh∆∞ m·ªôt "k·ªãch b·∫£n" ho·∫∑c "c√¥ng th·ª©c" ƒë·ªÉ t·∫°o ra Image.
- **Lu·ªìng l√†m vi·ªác:**
  `Dockerfile` --(`docker build . -t my_image_name`)--> `Image` üñºÔ∏è

### Registry (Docker Hub)

- L√† m·ªôt **kho l∆∞u tr·ªØ (repository)** t·∫≠p trung cho c√°c Docker Images.
- Cho ph√©p b·∫°n l∆∞u tr·ªØ, qu·∫£n l√Ω v√† chia s·∫ª Images.
- **Docker Hub**:
  - L√† registry **c√¥ng c·ªông** l·ªõn nh·∫•t v√† m·∫∑c ƒë·ªãnh c·ªßa Docker.
  - Ch·ª©a h√†ng ng√†n Images ƒë∆∞·ª£c t·∫°o s·∫µn b·ªüi c·ªông ƒë·ªìng v√† c√°c nh√† cung c·∫•p (v√≠ d·ª•: `ubuntu`, `nginx`, `python`, `mysql`).
  - B·∫°n c√≥ th·ªÉ t·∫°o t√†i kho·∫£n v√† push (ƒë·∫©y) Image c·ªßa m√¨nh l√™n Docker Hub (public ho·∫∑c private).
- **Private Registries**:
  - B·∫°n c≈©ng c√≥ th·ªÉ t·ª± host registry ri√™ng ho·∫∑c s·ª≠ d·ª•ng c√°c d·ªãch v·ª• private registry t·ª´ c√°c nh√† cung c·∫•p cloud.
  - V√≠ d·ª•: Amazon ECR (Elastic Container Registry), Google GCR (Google Container Registry), Azure ACR, Harbor.
- **C√°c l·ªánh c∆° b·∫£n:**

  - `docker pull <image_name>:<tag>`: T·∫£i (download) m·ªôt Image t·ª´ Registry v·ªÅ m√°y local.

    ```text
    [Local Machine] <--- (docker pull ubuntu) --- [‚òÅÔ∏è Docker Hub / Registry]
    ```

  - `docker push <your_username>/<image_name>:<tag>`: ƒê·∫©y (upload) m·ªôt Image t·ª´ m√°y local l√™n Registry.

    ```text
    [Local Machine] --- (docker push myuser/myimage) ---> [‚òÅÔ∏è Docker Hub / Registry]
    ```

  ```text
                             +-----------------------+
                             | Docker Hub / Registry |
                             | (e.g., AWS ECR, GCR)  |
                             +-----------‚î¨-----------+
                                         |
                      docker pull <image>|  docker push <image>
                                         |
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ                                           ‚îÇ
                   ‚ñº                                           ‚ñ≤
      +---------------------------+               +---------------------------+
      |      Local Machine 1      |               |      Local Machine 2      |
      | (Dev, CI/CD Server, etc.) |               | (Production Server, etc.) |
      +---------------------------+               +---------------------------+
  ```

## 4. ‚öôÔ∏è Docker CLI C∆° B·∫£n

C√∫ ph√°p chung: `docker [COMMAND] [OPTIONS] [ARGUMENTS]`

### Qu·∫£n l√Ω Images

- `docker images`: Li·ªát k√™ c√°c images c√≥ tr√™n local machine.
- `docker pull <image_name>:<tag>`: T·∫£i image t·ª´ registry.
  - V√≠ d·ª•: `docker pull nginx:latest`
  - V√≠ d·ª•: `docker pull ubuntu:20.04`
- `docker rmi <image_id_or_name>`: X√≥a m·ªôt image.
  - `docker rmi $(docker images -q -f dangling=true)`: X√≥a c√°c image "dangling" (kh√¥ng ƒë∆∞·ª£c tag v√† kh√¥ng ƒë∆∞·ª£c container n√†o s·ª≠ d·ª•ng).
- `docker build -t <image_name>:<tag> <path_to_dockerfile_directory>`: Build image t·ª´ Dockerfile.
  - V√≠ d·ª•: `docker build -t myapp:1.0 .` (d·∫•u `.` l√† th∆∞ m·ª•c hi·ªán t·∫°i)

### Qu·∫£n l√Ω Containers

- `docker run [OPTIONS] <image_name>:<tag> [COMMAND] [ARG...]`: T·∫°o v√† ch·∫°y m·ªôt container m·ªõi t·ª´ image.
  - `docker run hello-world`: Ch·∫°y container `hello-world` ƒë∆°n gi·∫£n.
  - `docker run -d -p 8080:80 nginx`:
    - `-d` (detached): Ch·∫°y container ·ªü background.
    - `-p 8080:80` (port mapping): Map port `8080` c·ªßa host t·ªõi port `80` c·ªßa container.
  - `docker run --name my_nginx -d -p 8081:80 nginx`: ƒê·∫∑t t√™n cho container l√† `my_nginx`.
  - `docker run -it ubuntu bash`: Ch·∫°y container `ubuntu` v√† m·ªü terminal `bash` t∆∞∆°ng t√°c.
    - `-i` (interactive): Gi·ªØ STDIN m·ªü.
    - `-t` (tty): C·∫•p m·ªôt pseudo-TTY.
- `docker ps`: Li·ªát k√™ c√°c container ƒëang ch·∫°y.
  - `docker ps -a`: Li·ªát k√™ t·∫•t c·∫£ container (c·∫£ ƒëang ch·∫°y v√† ƒë√£ d·ª´ng).
- `docker stop <container_id_or_name>`: D·ª´ng m·ªôt container ƒëang ch·∫°y.
- `docker start <container_id_or_name>`: Kh·ªüi ƒë·ªông l·∫°i m·ªôt container ƒë√£ d·ª´ng.
- `docker rm <container_id_or_name>`: X√≥a m·ªôt container (ph·∫£i d·ª´ng tr∆∞·ªõc).
  - `docker rm -f <container_id_or_name>`: X√≥a container (k·ªÉ c·∫£ ƒëang ch·∫°y - force).
  - `docker container prune`: X√≥a t·∫•t c·∫£ c√°c container ƒë√£ d·ª´ng.

### T∆∞∆°ng t√°c v·ªõi Container

- `docker logs <container_id_or_name>`: Xem logs c·ªßa container.
  - `docker logs -f <container_id_or_name>`: Theo d√µi logs (follow).
- `docker exec -it <container_id_or_name> <command>`: Ch·∫°y m·ªôt l·ªánh b√™n trong container ƒëang ch·∫°y.
  - V√≠ d·ª•: `docker exec -it my_nginx bash` (m·ªü shell `bash` trong container `my_nginx`).
- `docker cp <host_path> <container_id_or_name>:<container_path>`: Copy file/folder t·ª´ host v√†o container.
- `docker cp <container_id_or_name>:<container_path> <host_path>`: Copy file/folder t·ª´ container ra host.

## 5. üìù Dockerfile: C√¥ng Th·ª©c T·∫°o Image

`Dockerfile` l√† file text kh√¥ng c√≥ ƒëu√¥i, m·∫∑c ƒë·ªãnh t√™n l√† `Dockerfile`.

### C√°c ch·ªâ th·ªã (Instructions) ph·ªï bi·∫øn

- `FROM <image>:<tag>`: Ch·ªâ ƒë·ªãnh base image. _Lu√¥n l√† instruction ƒë·∫ßu ti√™n._
  - V√≠ d·ª•: `FROM ubuntu:22.04`
  - V√≠ d·ª•: `FROM node:18-alpine`
- `WORKDIR /path/to/workdir`: Thi·∫øt l·∫≠p th∆∞ m·ª•c l√†m vi·ªác cho c√°c instruction ti·∫øp theo (`RUN`, `CMD`, `ENTRYPOINT`, `COPY`, `ADD`).
  - V√≠ d·ª•: `WORKDIR /app`
- `COPY <src_on_host> <dest_in_image>`: Sao ch√©p file/th∆∞ m·ª•c t·ª´ host v√†o image.
  - V√≠ d·ª•: `COPY . .` (sao ch√©p to√†n b·ªô n·ªôi dung th∆∞ m·ª•c build context v√†o WORKDIR)
  - V√≠ d·ª•: `COPY package.json .`
- `RUN <command>`: Th·ª±c thi l·ªánh trong m·ªôt layer m·ªõi c·ªßa image (th∆∞·ªùng d√πng ƒë·ªÉ c√†i ƒë·∫∑t packages, dependencies).
  - V√≠ d·ª•: `RUN apt-get update && apt-get install -y nginx`
  - V√≠ d·ª•: `RUN npm install`
- `EXPOSE <port>`: Th√¥ng b√°o Docker r·∫±ng container s·∫Ω l·∫Øng nghe tr√™n port n√†y khi ch·∫°y. _Kh√¥ng t·ª± ƒë·ªông publish port, c·∫ßn `-p` khi `docker run`._
  - V√≠ d·ª•: `EXPOSE 80`
- `CMD ["executable","param1","param2"]` (exec form, ∆∞u ti√™n) ho·∫∑c `CMD command param1 param2` (shell form): Cung c·∫•p l·ªánh m·∫∑c ƒë·ªãnh s·∫Ω ƒë∆∞·ª£c th·ª±c thi khi container kh·ªüi ƒë·ªông. _Ch·ªâ c√≥ m·ªôt `CMD` c√≥ hi·ªáu l·ª±c, n·∫øu c√≥ nhi·ªÅu `CMD` th√¨ `CMD` cu·ªëi c√πng s·∫Ω ƒë∆∞·ª£c d√πng._ C√≥ th·ªÉ b·ªã override b·ªüi command khi `docker run`.
  - V√≠ d·ª•: `CMD ["nginx", "-g", "daemon off;"]`
  - V√≠ d·ª•: `CMD ["npm", "start"]`
- `ENTRYPOINT ["executable","param1","param2"]` (exec form, ∆∞u ti√™n) ho·∫∑c `ENTRYPOINT command param1 param2` (shell form): C·∫•u h√¨nh container s·∫Ω ch·∫°y nh∆∞ m·ªôt executable. C√°c tham s·ªë truy·ªÅn v√†o `docker run` s·∫Ω ƒë∆∞·ª£c n·ªëi v√†o sau `ENTRYPOINT`. `CMD` c√≥ th·ªÉ ƒë∆∞·ª£c d√πng ƒë·ªÉ cung c·∫•p tham s·ªë m·∫∑c ƒë·ªãnh cho `ENTRYPOINT`.
- `ENV <key>=<value>`: Thi·∫øt l·∫≠p bi·∫øn m√¥i tr∆∞·ªùng.
  - V√≠ d·ª•: `ENV NODE_ENV=production`

### V√≠ d·ª• Dockerfile ƒë∆°n gi·∫£n (Node.js App)

```dockerfile
# S·ª≠ d·ª•ng Node.js phi√™n b·∫£n 18-alpine l√†m base image
FROM node:18-alpine

# Thi·∫øt l·∫≠p th∆∞ m·ª•c l√†m vi·ªác b√™n trong container
WORKDIR /usr/src/app

# Sao ch√©p package.json v√† package-lock.json (n·∫øu c√≥)
COPY package*.json ./

# C√†i ƒë·∫∑t c√°c dependencies
RUN npm install

# Sao ch√©p to√†n b·ªô source code c·ªßa ·ª©ng d·ª•ng
COPY . .

# Th√¥ng b√°o port m√† ·ª©ng d·ª•ng s·∫Ω ch·∫°y tr√™n ƒë√≥
EXPOSE 3000

# L·ªánh ƒë·ªÉ ch·∫°y ·ª©ng d·ª•ng khi container kh·ªüi ƒë·ªông
CMD [ "node", "server.js" ]
```

## 6. üõ†Ô∏è Th·ª±c H√†nh: Dockerize ·ª®ng D·ª•ng "Hello World" v·ªõi Nginx

M·ª•c ti√™u: T·∫°o m·ªôt `Dockerfile` ƒë·ªÉ ph·ª•c v·ª• m·ªôt trang `index.html` ƒë∆°n gi·∫£n b·∫±ng `Nginx`.

1. **T·∫°o file `index.html`:**

   ```html
   <!-- index.html -->
   <!DOCTYPE html>
   <html>
     <head>
       <title>Hello Docker!</title>
     </head>
     <body>
       <h1>Hello from Nginx inside Docker!</h1>
       <p>This is my first Dockerized web page.</p>
     </body>
   </html>
   ```

2. **T·∫°o file `Dockerfile`:**

   ```dockerfile
   # S·ª≠ d·ª•ng Nginx image ch√≠nh th·ª©c t·ª´ Docker Hub
   FROM nginx:alpine

   # X√≥a file index.html m·∫∑c ƒë·ªãnh c·ªßa Nginx
   RUN rm /usr/share/nginx/html/index.html

   # Sao ch√©p file index.html t√πy ch·ªânh c·ªßa ch√∫ng ta v√†o th∆∞ m·ª•c ph·ª•c v·ª• web c·ªßa Nginx
   COPY index.html /usr/share/nginx/html/

   # Expose port 80 (Nginx m·∫∑c ƒë·ªãnh ch·∫°y tr√™n port 80)
   EXPOSE 80

   # L·ªánh m·∫∑c ƒë·ªãnh ƒë·ªÉ Nginx ch·∫°y ·ªü foreground (c·∫ßn thi·∫øt cho Docker)
   CMD ["nginx", "-g", "daemon off;"]
   ```

3. **Build Docker image:**
   M·ªü terminal trong th∆∞ m·ª•c ch·ª©a `index.html` v√† `Dockerfile`.

   ```bash
   docker build -t my-first-nginx .
   ```

   Ki·ªÉm tra image: `docker images` (b·∫°n s·∫Ω th·∫•y `my-first-nginx`).

4. **Ch·∫°y container t·ª´ image v·ª´a build:**

   ```bash
   docker run -d -p 8080:80 --name web_test my-first-nginx
   ```

   - `-d`: ch·∫°y background
   - `-p 8080:80`: map port 8080 c·ªßa host t·ªõi port 80 c·ªßa container
   - `--name web_test`: ƒë·∫∑t t√™n cho container

5. **Ki·ªÉm tra:**
   M·ªü tr√¨nh duy·ªát v√† truy c·∫≠p `http://localhost:8080`. B·∫°n s·∫Ω th·∫•y trang "Hello Docker!".

6. **D·ªçn d·∫πp:**

   ```bash
   docker stop web_test
   docker rm web_test
   # docker rmi my-first-nginx # N·∫øu mu·ªën x√≥a c·∫£ image
   ```

## 7. üèãÔ∏è B√†i T·∫≠p

**Y√™u c·∫ßu:** Dockerize m·ªôt ·ª©ng d·ª•ng web tƒ©nh ƒë∆°n gi·∫£n.

1. **Chu·∫©n b·ªã:**

   - T·∫°o m·ªôt th∆∞ m·ª•c m·ªõi cho b√†i t·∫≠p, v√≠ d·ª• `my-static-app`.
   - B√™n trong th∆∞ m·ª•c ƒë√≥, t·∫°o m·ªôt file `index.html` v·ªõi n·ªôi dung HTML t√πy √Ω c·ªßa b·∫°n (v√≠ d·ª•: gi·ªõi thi·ªáu b·∫£n th√¢n, m·ªôt trang "Coming Soon" ƒë∆°n gi·∫£n, v.v.).
   - (T√πy ch·ªçn) Th√™m m·ªôt file CSS (`style.css`) v√† m·ªôt h√¨nh ·∫£nh (`logo.png`) v√† li√™n k·∫øt ch√∫ng t·ª´ `index.html`.

2. **Vi·∫øt `Dockerfile`:**

   - S·ª≠ d·ª•ng m·ªôt base image web server ph√π h·ª£p (v√≠ d·ª•: `nginx:alpine` ho·∫∑c `httpd:alpine`).
   - `COPY` c√°c file tƒ©nh c·ªßa b·∫°n (`index.html`, `style.css`, `logo.png`) v√†o th∆∞ m·ª•c th√≠ch h·ª£p c·ªßa web server b√™n trong image (v√≠ d·ª•: `/usr/share/nginx/html` cho Nginx, ho·∫∑c `/usr/local/apache2/htdocs/` cho httpd).
   - `EXPOSE` port m√† web server l·∫Øng nghe (th∆∞·ªùng l√† port 80).
   - ƒê·∫£m b·∫£o web server ch·∫°y ·ªü foreground khi container kh·ªüi ƒë·ªông (tham kh·∫£o `CMD` c·ªßa Nginx ho·∫∑c httpd).

3. **Build v√† Run:**

   - Build image v·ªõi m·ªôt t√™n v√† tag t√πy ch·ªçn (v√≠ d·ª•: `my-page:1.0`).
   - Ch·∫°y container t·ª´ image ƒë√≥, map m·ªôt port tr√™n host (v√≠ d·ª•: 9090) t·ªõi port 80 c·ªßa container.
   - Truy c·∫≠p trang web c·ªßa b·∫°n qua tr√¨nh duy·ªát (`http://localhost:9090`).

4. **Thao t√°c th√™m (optional):**
   - Xem logs c·ªßa container.
   - Ch·∫°y m·ªôt l·ªánh `ls` b√™n trong container ƒëang ch·∫°y ƒë·ªÉ ki·ªÉm tra xem file ƒë√£ ƒë∆∞·ª£c copy ƒë√∫ng ch·ªó ch∆∞a (s·ª≠ d·ª•ng `docker exec`).
   - D·ª´ng v√† x√≥a container.

**G·ª£i √Ω:**

- N·∫øu d√πng Nginx, b·∫°n c√≥ th·ªÉ c·∫ßn `COPY` c√°c file v√†o `/usr/share/nginx/html/`.
- N·∫øu d√πng Apache httpd, b·∫°n c√≥ th·ªÉ c·∫ßn `COPY` c√°c file v√†o `/usr/local/apache2/htdocs/`.

---

[‚¨ÖÔ∏è Tr·ªü l·∫°i: PHP/Part6.md](../PHP/Part6.md) |
[üè† Home](../README.md) |
[‚û°Ô∏è Ti·∫øp theo: DEVOPS/Docker2.md](../DEVOPS/Docker2.md)
