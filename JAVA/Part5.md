# üìò PH·∫¶N 5: LU·ªíNG, ƒêA LU·ªíNG V√Ä JDBC

## N·ªôi dung

- [üìò PH·∫¶N 5: LU·ªíNG, ƒêA LU·ªíNG V√Ä JDBC](#-ph·∫ßn-5-lu·ªìng-ƒëa-lu·ªìng-v√†-jdbc)
  - [Table of Contents](#table-of-contents)
  - [üéØ M·ª•c ti√™u t·ªïng qu√°t](#-m·ª•c-ti√™u-t·ªïng-qu√°t)
  - [üßë‚Äçüè´ B√†i 1: Java I/O Streams](#-b√†i-1-java-io-streams)
  - [üßë‚Äçüè´ B√†i 2: ƒêa lu·ªìng trong Java](#-b√†i-2-ƒëa-lu·ªìng-trong-java)
  - [üßë‚Äçüè´ B√†i 3: L·∫≠p tr√¨nh ƒë·ªìng th·ªùi (Concurrency)](#-b√†i-3-l·∫≠p-tr√¨nh-ƒë·ªìng-th·ªùi-concurrency)
  - [üßë‚Äçüè´ B√†i 4: K·∫øt n·ªëi c∆° s·ªü d·ªØ li·ªáu v·ªõi JDBC](#-b√†i-4-k·∫øt-n·ªëi-c∆°-s·ªü-d·ªØ-li·ªáu-v·ªõi-jdbc)
  - [üßë‚Äçüè´ B√†i 5: Thao t√°c CRUD v·ªõi JDBC](#-b√†i-5-thao-t√°c-crud-v·ªõi-jdbc)
  - [üßë‚Äçüè´ B√†i 6: Th·ª±c h√†nh vi·∫øt ·ª©ng d·ª•ng v·ªõi JDBC](#-b√†i-6-th·ª±c-h√†nh-vi·∫øt-·ª©ng-d·ª•ng-v·ªõi-jdbc)
  - [üß™ B√ÄI T·∫¨P L·ªöN CU·ªêI PH·∫¶N](#-b√†i-t·∫≠p-l·ªõn-cu·ªëi-ph·∫ßn)
    - [**ƒê·ªÅ b√†i: H·ªá th·ªëng qu·∫£n l√Ω sinh vi√™n v·ªõi c∆° s·ªü d·ªØ li·ªáu**](#ƒë·ªÅ-b√†i-h·ªá-th·ªëng-qu·∫£n-l√Ω-sinh-vi√™n-v·ªõi-c∆°-s·ªü-d·ªØ-li·ªáu)

## üéØ M·ª•c ti√™u t·ªïng qu√°t

- Hi·ªÉu c√°ch x·ª≠ l√Ω nh·∫≠p/xu·∫•t d·ªØ li·ªáu b·∫±ng lu·ªìng (Streams).
- L√†m quen v·ªõi l·∫≠p tr√¨nh ƒëa lu·ªìng (Multithreading).
- K·∫øt n·ªëi v√† thao t√°c d·ªØ li·ªáu v·ªõi c∆° s·ªü d·ªØ li·ªáu s·ª≠ d·ª•ng JDBC.

---

## üßë‚Äçüè´ B√†i 1: Java I/O Streams

- Kh√°i ni·ªám lu·ªìng trong Java: `InputStream`, `OutputStream`, `Reader`, `Writer`.
- Ph√¢n bi·ªát lu·ªìng nh·ªã ph√¢n v√† lu·ªìng k√Ω t·ª±.
- C√°c l·ªõp th∆∞·ªùng d√πng: `FileInputStream`, `FileOutputStream`, `BufferedReader`, `BufferedWriter`.
- ƒê·ªçc v√† ghi file b·∫±ng stream v·ªõi x·ª≠ l√Ω ngo·∫°i l·ªá.

---

## üßë‚Äçüè´ B√†i 2: ƒêa lu·ªìng trong Java

- Kh√°i ni·ªám Thread v√† l·ª£i √≠ch c·ªßa ƒëa lu·ªìng.
- T·∫°o thread b·∫±ng k·∫ø th·ª´a `Thread` ho·∫∑c tri·ªÉn khai `Runnable`.
- Qu·∫£n l√Ω lu·ªìng b·∫±ng `start()`, `join()`, `sleep()`.
- V·∫•n ƒë·ªÅ ƒë·ªìng b·ªô (synchronization), s·ª≠ d·ª•ng t·ª´ kh√≥a `synchronized`.

---

## üßë‚Äçüè´ B√†i 3: L·∫≠p tr√¨nh ƒë·ªìng th·ªùi (Concurrency)

- Qu·∫£n l√Ω thread n√¢ng cao v·ªõi `ExecutorService`.
- Gi·ªõi thi·ªáu `Callable`, `Future`.
- ƒê·ªìng b·ªô d·ªØ li·ªáu trong m√¥i tr∆∞·ªùng ƒëa lu·ªìng.
- ·ª®ng d·ª•ng th·ª±c t·∫ø: t·∫£i song song d·ªØ li·ªáu, x·ª≠ l√Ω ƒëa nhi·ªám.

---

## üßë‚Äçüè´ B√†i 4: K·∫øt n·ªëi c∆° s·ªü d·ªØ li·ªáu v·ªõi JDBC

- T·ªïng quan v·ªÅ JDBC v√† c√°c b∆∞·ªõc k·∫øt n·ªëi:
  1. T·∫£i driver JDBC.
  2. T·∫°o k·∫øt n·ªëi (`Connection`).
  3. Th·ª±c thi truy v·∫•n (`Statement`, `PreparedStatement`).
  4. ƒê·ªçc k·∫øt qu·∫£ (`ResultSet`).
- K·∫øt n·ªëi v·ªõi MySQL (ho·∫∑c SQLite).
- C√°ch d√πng `try-with-resources` khi l√†m vi·ªác v·ªõi JDBC.

1. **T·∫£i Driver v√† t·∫°o k·∫øt n·ªëi:**

   ```java
   // T·∫£i driver (ch·ªâ c·∫ßn l√†m m·ªôt l·∫ßn)
   try {
       Class.forName("com.mysql.cj.jdbc.Driver");
       // Ho·∫∑c v·ªõi SQLite: Class.forName("org.sqlite.JDBC");
   } catch (ClassNotFoundException e) {
       System.out.println("Kh√¥ng t√¨m th·∫•y Driver JDBC");
       e.printStackTrace();
   }

   // T·∫°o k·∫øt n·ªëi
   String url = "jdbc:mysql://localhost:3306/mydatabase";
   String username = "root";
   String password = "password";

   try (Connection connection = DriverManager.getConnection(url, username, password)) {
       System.out.println("K·∫øt n·ªëi th√†nh c√¥ng ƒë·∫øn c∆° s·ªü d·ªØ li·ªáu!");
       // Thao t√°c v·ªõi database
   } catch (SQLException e) {
       System.out.println("K·∫øt n·ªëi th·∫•t b·∫°i!");
       e.printStackTrace();
   }
   ```

2. **S·ª≠ d·ª•ng Statement ƒë·ªÉ th·ª±c thi truy v·∫•n:**

   ```java
   public static void executeSimpleQuery(Connection conn) throws SQLException {
       // T·∫°o Statement
       try (Statement stmt = conn.createStatement()) {
           // Th·ª±c thi truy v·∫•n SQL
           String sql = "SELECT id, name, email FROM users";
           ResultSet rs = stmt.executeQuery(sql);

           // X·ª≠ l√Ω k·∫øt qu·∫£
           while (rs.next()) {
               int id = rs.getInt("id");
               String name = rs.getString("name");
               String email = rs.getString("email");

               System.out.println("ID: " + id + ", T√™n: " + name + ", Email: " + email);
           }
       }
   }
   ```

3. **S·ª≠ d·ª•ng PreparedStatement ƒë·ªÉ th·ª±c thi truy v·∫•n an to√†n:**

   ```java
   public static void findUserById(Connection conn, int userId) throws SQLException {
       String sql = "SELECT id, name, email FROM users WHERE id = ?";

       // T·∫°o PreparedStatement
       try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
           // ƒê·∫∑t tham s·ªë
           pstmt.setInt(1, userId);

           // Th·ª±c thi truy v·∫•n
           ResultSet rs = pstmt.executeQuery();

           // X·ª≠ l√Ω k·∫øt qu·∫£
           if (rs.next()) {
               String name = rs.getString("name");
               String email = rs.getString("email");

               System.out.println("T√¨m th·∫•y ng∆∞·ªùi d√πng:");
               System.out.println("ID: " + userId + ", T√™n: " + name + ", Email: " + email);
           } else {
               System.out.println("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng v·ªõi ID: " + userId);
           }
       }
   }
   ```

4. **S·ª≠ d·ª•ng try-with-resources v·ªõi JDBC:**

   ```java
   public static void safeDatabaseOperation() {
       String url = "jdbc:mysql://localhost:3306/mydatabase";
       String username = "root";
       String password = "password";

       // try-with-resources s·∫Ω t·ª± ƒë·ªông ƒë√≥ng Connection, Statement v√† ResultSet
       try (
           Connection conn = DriverManager.getConnection(url, username, password);
           Statement stmt = conn.createStatement();
           ResultSet rs = stmt.executeQuery("SELECT COUNT(*) AS user_count FROM users")
       ) {
           if (rs.next()) {
               int count = rs.getInt("user_count");
               System.out.println("T·ªïng s·ªë ng∆∞·ªùi d√πng: " + count);
           }
       } catch (SQLException e) {
           System.out.println("L·ªói khi thao t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu:");
           e.printStackTrace();
       }
   }
   ```

5. **V√≠ d·ª• th·ª±c t·∫ø - K·∫øt n·ªëi v√† truy v·∫•n c∆° s·ªü d·ªØ li·ªáu:**

   ```java
   import java.sql.*;

   public class JDBCExample {
       public static void main(String[] args) {
           String url = "jdbc:mysql://localhost:3306/library_db";
           String username = "root";
           String password = "password";

           try (Connection conn = DriverManager.getConnection(url, username, password)) {
               System.out.println("K·∫øt n·ªëi th√†nh c√¥ng ƒë·∫øn c∆° s·ªü d·ªØ li·ªáu!");

               // T√¨m t·∫•t c·∫£ s√°ch xu·∫•t b·∫£n sau nƒÉm 2020
               findBooksByYear(conn, 2020);

               // T√¨m s√°ch theo t√°c gi·∫£
               findBooksByAuthor(conn, "Nguy·ªÖn Nh·∫≠t √Ånh");

           } catch (SQLException e) {
               System.out.println("L·ªói k·∫øt n·ªëi: " + e.getMessage());
               e.printStackTrace();
           }
       }

       public static void findBooksByYear(Connection conn, int year) throws SQLException {
           String sql = "SELECT id, title, author, published_year FROM books WHERE published_year > ?";

           try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
               pstmt.setInt(1, year);
               ResultSet rs = pstmt.executeQuery();

               System.out.println("\nS√°ch xu·∫•t b·∫£n sau nƒÉm " + year + ":");
               while (rs.next()) {
                   System.out.printf("ID: %d, Ti√™u ƒë·ªÅ: %s, T√°c gi·∫£: %s, NƒÉm: %d\n",
                       rs.getInt("id"),
                       rs.getString("title"),
                       rs.getString("author"),
                       rs.getInt("published_year"));
               }
           }
       }

       public static void findBooksByAuthor(Connection conn, String authorName) throws SQLException {
           String sql = "SELECT id, title, published_year FROM books WHERE author LIKE ?";

           try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
               pstmt.setString(1, "%" + authorName + "%");  // T√¨m ki·∫øm m·ªù
               ResultSet rs = pstmt.executeQuery();

               System.out.println("\nS√°ch c·ªßa t√°c gi·∫£ c√≥ t√™n '" + authorName + "':");
               boolean found = false;

               while (rs.next()) {
                   found = true;
                   System.out.printf("ID: %d, Ti√™u ƒë·ªÅ: %s, NƒÉm xu·∫•t b·∫£n: %d\n",
                       rs.getInt("id"),
                       rs.getString("title"),
                       rs.getInt("published_year"));
               }

               if (!found) {
                   System.out.println("Kh√¥ng t√¨m th·∫•y s√°ch n√†o c·ªßa t√°c gi·∫£ n√†y.");
               }
           }
       }
   }
   ```

---

## üßë‚Äçüè´ B√†i 5: Thao t√°c CRUD v·ªõi JDBC

- T·∫°o b·∫£ng v√† th√™m d·ªØ li·ªáu t·ª´ Java.
- Truy v·∫•n d·ªØ li·ªáu v√† hi·ªÉn th·ªã k·∫øt qu·∫£.
- C·∫≠p nh·∫≠t v√† x√≥a d·ªØ li·ªáu v·ªõi `PreparedStatement`.
- X·ª≠ l√Ω l·ªói v√† ƒë√≥ng k·∫øt n·ªëi ƒë√∫ng c√°ch.

1. **T·∫°o b·∫£ng trong c∆° s·ªü d·ªØ li·ªáu:**

   ```java
   public static void createTable(Connection conn) throws SQLException {
       String sql = "CREATE TABLE IF NOT EXISTS students (" +
                   "id INT AUTO_INCREMENT PRIMARY KEY," +
                   "name VARCHAR(100) NOT NULL," +
                   "email VARCHAR(100) UNIQUE," +
                   "age INT," +
                   "gpa DOUBLE" +
                   ")";

       try (Statement stmt = conn.createStatement()) {
           stmt.execute(sql);
           System.out.println("B·∫£ng 'students' ƒë√£ ƒë∆∞·ª£c t·∫°o ho·∫∑c ƒë√£ t·ªìn t·∫°i");
       }
   }
   ```

2. **Th√™m d·ªØ li·ªáu (Create):**

   ```java
   public static void addStudent(Connection conn, String name, String email, int age, double gpa)
           throws SQLException {
       String sql = "INSERT INTO students (name, email, age, gpa) VALUES (?, ?, ?, ?)";

       try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
           pstmt.setString(1, name);
           pstmt.setString(2, email);
           pstmt.setInt(3, age);
           pstmt.setDouble(4, gpa);

           int rowsInserted = pstmt.executeUpdate();
           if (rowsInserted > 0) {
               System.out.println("ƒê√£ th√™m th√†nh c√¥ng sinh vi√™n: " + name);
           }
       }
   }
   ```

3. **Truy v·∫•n d·ªØ li·ªáu (Read):**

   ```java
   public static void getAllStudents(Connection conn) throws SQLException {
       String sql = "SELECT id, name, email, age, gpa FROM students";

       try (Statement stmt = conn.createStatement();
            ResultSet rs = stmt.executeQuery(sql)) {

           if (!rs.isBeforeFirst()) {
               System.out.println("Kh√¥ng c√≥ sinh vi√™n n√†o trong c∆° s·ªü d·ªØ li·ªáu");
               return;
           }

           System.out.println("\n----- DANH S√ÅCH SINH VI√äN -----");
           System.out.printf("%-5s %-20s %-25s %-5s %-5s\n",
                           "ID", "H·ªç t√™n", "Email", "Tu·ªïi", "GPA");
           System.out.println("-----------------------------------------------------------");

           while (rs.next()) {
               System.out.printf("%-5d %-20s %-25s %-5d %-5.2f\n",
                               rs.getInt("id"),
                               rs.getString("name"),
                               rs.getString("email"),
                               rs.getInt("age"),
                               rs.getDouble("gpa"));
           }
       }
   }

   public static void findStudentByName(Connection conn, String searchName) throws SQLException {
       String sql = "SELECT id, name, email, age, gpa FROM students WHERE name LIKE ?";

       try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
           pstmt.setString(1, "%" + searchName + "%");

           try (ResultSet rs = pstmt.executeQuery()) {
               boolean found = false;

               System.out.println("\n----- T√åM KI·∫æM SINH VI√äN -----");
               System.out.printf("%-5s %-20s %-25s %-5s %-5s\n",
                               "ID", "H·ªç t√™n", "Email", "Tu·ªïi", "GPA");
               System.out.println("-----------------------------------------------------------");

               while (rs.next()) {
                   found = true;
                   System.out.printf("%-5d %-20s %-25s %-5d %-5.2f\n",
                                   rs.getInt("id"),
                                   rs.getString("name"),
                                   rs.getString("email"),
                                   rs.getInt("age"),
                                   rs.getDouble("gpa"));
               }

               if (!found) {
                   System.out.println("Kh√¥ng t√¨m th·∫•y sinh vi√™n n√†o c√≥ t√™n \"" + searchName + "\"");
               }
           }
       }
   }
   ```

4. **C·∫≠p nh·∫≠t d·ªØ li·ªáu (Update):**

   ```java
   public static void updateStudentGPA(Connection conn, int studentId, double newGPA)
           throws SQLException {
       String sql = "UPDATE students SET gpa = ? WHERE id = ?";

       try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
           pstmt.setDouble(1, newGPA);
           pstmt.setInt(2, studentId);

           int rowsUpdated = pstmt.executeUpdate();
           if (rowsUpdated > 0) {
               System.out.println("ƒê√£ c·∫≠p nh·∫≠t GPA c·ªßa sinh vi√™n c√≥ ID = " + studentId);
           } else {
               System.out.println("Kh√¥ng t√¨m th·∫•y sinh vi√™n c√≥ ID = " + studentId);
           }
       }
   }
   ```

5. **X√≥a d·ªØ li·ªáu (Delete):**

   ```java
   public static void deleteStudent(Connection conn, int studentId) throws SQLException {
       // Tr∆∞·ªõc ti√™n, ki·ªÉm tra xem sinh vi√™n c√≥ t·ªìn t·∫°i kh√¥ng
       String checkSql = "SELECT name FROM students WHERE id = ?";
       try (PreparedStatement checkStmt = conn.prepareStatement(checkSql)) {
           checkStmt.setInt(1, studentId);

           try (ResultSet rs = checkStmt.executeQuery()) {
               if (rs.next()) {
                   String studentName = rs.getString("name");

                   // Sinh vi√™n t·ªìn t·∫°i, ti·∫øn h√†nh x√≥a
                   String deleteSql = "DELETE FROM students WHERE id = ?";
                   try (PreparedStatement deleteStmt = conn.prepareStatement(deleteSql)) {
                       deleteStmt.setInt(1, studentId);

                       int rowsDeleted = deleteStmt.executeUpdate();
                       System.out.println("ƒê√£ x√≥a sinh vi√™n: " + studentName);
                   }
               } else {
                   System.out.println("Kh√¥ng t√¨m th·∫•y sinh vi√™n c√≥ ID = " + studentId);
               }
           }
       }
   }
   ```

6. **V√≠ d·ª• th·ª±c t·∫ø - Qu·∫£n l√Ω sinh vi√™n CRUD ho√†n ch·ªânh:**

   ```java
   import java.sql.*;
   import java.util.Scanner;

   public class StudentManagementSystem {
       // Th√¥ng tin k·∫øt n·ªëi CSDL
       private static final String URL = "jdbc:mysql://localhost:3306/school_db";
       private static final String USERNAME = "root";
       private static final String PASSWORD = "password";

       private static Scanner scanner = new Scanner(System.in);

       public static void main(String[] args) {
           try {
               // T·∫£i driver
               Class.forName("com.mysql.cj.jdbc.Driver");

               // T·∫°o k·∫øt n·ªëi
               try (Connection conn = DriverManager.getConnection(URL, USERNAME, PASSWORD)) {
                   // T·∫°o b·∫£ng n·∫øu ch∆∞a t·ªìn t·∫°i
                   createTable(conn);

                   boolean running = true;
                   while (running) {
                       displayMenu();
                       int choice = scanner.nextInt();
                       scanner.nextLine(); // ƒê·ªçc newline

                       switch (choice) {
                           case 1:
                               addNewStudent(conn);
                               break;
                           case 2:
                               viewAllStudents(conn);
                               break;
                           case 3:
                               searchStudent(conn);
                               break;
                           case 4:
                               updateStudent(conn);
                               break;
                           case 5:
                               deleteStudentRecord(conn);
                               break;
                           case 0:
                               running = false;
                               System.out.println("C·∫£m ∆°n b·∫°n ƒë√£ s·ª≠ d·ª•ng ch∆∞∆°ng tr√¨nh!");
                               break;
                           default:
                               System.out.println("L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!");
                       }
                   }
               }
           } catch (ClassNotFoundException e) {
               System.out.println("Kh√¥ng t√¨m th·∫•y Driver JDBC: " + e.getMessage());
           } catch (SQLException e) {
               System.out.println("L·ªói SQL: " + e.getMessage());
               e.printStackTrace();
           }
       }

       private static void displayMenu() {
           System.out.println("\n----- H·ªÜ TH·ªêNG QU·∫¢N L√ù SINH VI√äN -----");
           System.out.println("1. Th√™m sinh vi√™n m·ªõi");
           System.out.println("2. Xem t·∫•t c·∫£ sinh vi√™n");
           System.out.println("3. T√¨m ki·∫øm sinh vi√™n theo t√™n");
           System.out.println("4. C·∫≠p nh·∫≠t GPA c·ªßa sinh vi√™n");
           System.out.println("5. X√≥a sinh vi√™n");
           System.out.println("0. Tho√°t");
           System.out.print("Ch·ªçn ch·ª©c nƒÉng: ");
       }

       private static void addNewStudent(Connection conn) throws SQLException {
           System.out.println("\n----- TH√äM SINH VI√äN M·ªöI -----");

           System.out.print("Nh·∫≠p t√™n sinh vi√™n: ");
           String name = scanner.nextLine();

           System.out.print("Nh·∫≠p email: ");
           String email = scanner.nextLine();

           System.out.print("Nh·∫≠p tu·ªïi: ");
           int age = scanner.nextInt();

           System.out.print("Nh·∫≠p GPA: ");
           double gpa = scanner.nextDouble();
           scanner.nextLine(); // ƒê·ªçc newline

           addStudent(conn, name, email, age, gpa);
       }

       private static void viewAllStudents(Connection conn) throws SQLException {
           getAllStudents(conn);
       }

       private static void searchStudent(Connection conn) throws SQLException {
           System.out.print("\nNh·∫≠p t√™n sinh vi√™n c·∫ßn t√¨m: ");
           String searchName = scanner.nextLine();

           findStudentByName(conn, searchName);
       }

       private static void updateStudent(Connection conn) throws SQLException {
           System.out.print("\nNh·∫≠p ID c·ªßa sinh vi√™n c·∫ßn c·∫≠p nh·∫≠t: ");
           int id = scanner.nextInt();

           System.out.print("Nh·∫≠p GPA m·ªõi: ");
           double newGPA = scanner.nextDouble();
           scanner.nextLine(); // ƒê·ªçc newline

           updateStudentGPA(conn, id, newGPA);
       }

       private static void deleteStudentRecord(Connection conn) throws SQLException {
           System.out.print("\nNh·∫≠p ID c·ªßa sinh vi√™n c·∫ßn x√≥a: ");
           int id = scanner.nextInt();
           scanner.nextLine(); // ƒê·ªçc newline

           System.out.print("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a sinh vi√™n n√†y? (y/n): ");
           String confirm = scanner.nextLine();

           if (confirm.equalsIgnoreCase("y")) {
               deleteStudent(conn, id);
           } else {
               System.out.println("ƒê√£ h·ªßy thao t√°c x√≥a");
           }
       }

       // Ph∆∞∆°ng th·ª©c CRUD kh√°c ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a ·ªü tr√™n...
   }
   ```

7. **X·ª≠ l√Ω l·ªói v√† Transaction:**

   ```java
   public static void registerStudentWithCourses(Connection conn, String studentName,
                                              String email, int[] courseIds) throws SQLException {
       // V√¥ hi·ªáu h√≥a auto-commit ƒë·ªÉ s·ª≠ d·ª•ng transaction
       boolean autoCommit = conn.getAutoCommit();
       conn.setAutoCommit(false);

       try {
           // 1. Th√™m sinh vi√™n m·ªõi
           String insertStudentSql = "INSERT INTO students (name, email) VALUES (?, ?)";
           int studentId;

           try (PreparedStatement pstmt = conn.prepareStatement(insertStudentSql,
                                                           Statement.RETURN_GENERATED_KEYS)) {
               pstmt.setString(1, studentName);
               pstmt.setString(2, email);
               pstmt.executeUpdate();

               // L·∫•y ID c·ªßa sinh vi√™n v·ª´a th√™m
               try (ResultSet rs = pstmt.getGeneratedKeys()) {
                   if (rs.next()) {
                       studentId = rs.getInt(1);
                   } else {
                       throw new SQLException("Kh√¥ng th·ªÉ l·∫•y ID c·ªßa sinh vi√™n v·ª´a th√™m");
                   }
               }
           }

           // 2. ƒêƒÉng k√Ω sinh vi√™n v√†o c√°c kh√≥a h·ªçc
           String registerCourseSql = "INSERT INTO student_courses (student_id, course_id) VALUES (?, ?)";

           try (PreparedStatement pstmt = conn.prepareStatement(registerCourseSql)) {
               for (int courseId : courseIds) {
                   pstmt.setInt(1, studentId);
                   pstmt.setInt(2, courseId);
                   pstmt.executeUpdate();
               }
           }

           // N·∫øu m·ªçi th·ª© OK, commit transaction
           conn.commit();
           System.out.println("ƒê√£ ƒëƒÉng k√Ω sinh vi√™n " + studentName + " v·ªõi " +
                              courseIds.length + " kh√≥a h·ªçc");

       } catch (SQLException e) {
           // N·∫øu c√≥ l·ªói, rollback
           try {
               System.out.println("Transaction b·ªã l·ªói, ƒëang rollback...");
               conn.rollback();
           } catch (SQLException ex) {
               System.out.println("L·ªói khi rollback: " + ex.getMessage());
           }
           throw e;
       } finally {
           // Kh√¥i ph·ª•c tr·∫°ng th√°i auto-commit
           conn.setAutoCommit(autoCommit);
       }
   }
   ```

---

## üßë‚Äçüè´ B√†i 6: Th·ª±c h√†nh vi·∫øt ·ª©ng d·ª•ng v·ªõi JDBC

- Thi·∫øt k·∫ø c∆° s·ªü d·ªØ li·ªáu cho ·ª©ng d·ª•ng qu·∫£n l√Ω.
- T·∫°o l·ªõp DAO (Data Access Object) cho c√°c thao t√°c d·ªØ li·ªáu.
- K·∫øt h·ª£p ki·∫øn th·ª©c v·ªÅ lu·ªìng, ƒëa lu·ªìng v√† JDBC.
- X√¢y d·ª±ng ·ª©ng d·ª•ng qu·∫£n l√Ω ho√†n ch·ªânh v·ªõi nhi·ªÅu ch·ª©c nƒÉng.

1. **Thi·∫øt k·∫ø c∆° s·ªü d·ªØ li·ªáu ƒë∆°n gi·∫£n:**

   ```sql
   CREATE TABLE students (
       id INT AUTO_INCREMENT PRIMARY KEY,
       student_id VARCHAR(10) UNIQUE NOT NULL,
       name VARCHAR(100) NOT NULL,
       birth_date DATE,
       email VARCHAR(100) UNIQUE,
       phone VARCHAR(15)
   );

   CREATE TABLE courses (
       id INT AUTO_INCREMENT PRIMARY KEY,
       course_code VARCHAR(10) UNIQUE NOT NULL,
       course_name VARCHAR(100) NOT NULL,
       credits INT
   );

   CREATE TABLE enrollments (
       id INT AUTO_INCREMENT PRIMARY KEY,
       student_id INT,
       course_id INT,
       enrollment_date DATE,
       grade DOUBLE,
       FOREIGN KEY (student_id) REFERENCES students(id),
       FOREIGN KEY (course_id) REFERENCES courses(id),
       UNIQUE (student_id, course_id)
   );
   ```

2. **L·ªõp k·∫øt n·ªëi c∆° s·ªü d·ªØ li·ªáu:**

   ```java
   public class DatabaseConnection {
       private static final String URL = "jdbc:mysql://localhost:3306/school_management";
       private static final String USERNAME = "root";
       private static final String PASSWORD = "password";

       private static Connection connection = null;

       public static Connection getConnection() throws SQLException {
           if (connection == null || connection.isClosed()) {
               try {
                   Class.forName("com.mysql.cj.jdbc.Driver");
                   connection = DriverManager.getConnection(URL, USERNAME, PASSWORD);
               } catch (ClassNotFoundException e) {
                   throw new SQLException("JDBC Driver kh√¥ng t√¨m th·∫•y", e);
               }
           }
           return connection;
       }

       public static void closeConnection() {
           if (connection != null) {
               try {
                   connection.close();
               } catch (SQLException e) {
                   System.out.println("L·ªói khi ƒë√≥ng k·∫øt n·ªëi: " + e.getMessage());
               }
           }
       }
   }
   ```

3. **L·ªõp DAO cho Student:**

   ```java
   public class StudentDAO {
       private Connection conn;

       public StudentDAO() throws SQLException {
           this.conn = DatabaseConnection.getConnection();
       }

       // Th√™m sinh vi√™n m·ªõi
       public boolean addStudent(Student student) throws SQLException {
           String sql = "INSERT INTO students (student_id, name, birth_date, email, phone) " +
                       "VALUES (?, ?, ?, ?, ?)";

           try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
               pstmt.setString(1, student.getStudentId());
               pstmt.setString(2, student.getName());
               pstmt.setDate(3, new java.sql.Date(student.getBirthDate().getTime()));
               pstmt.setString(4, student.getEmail());
               pstmt.setString(5, student.getPhone());

               int rowsInserted = pstmt.executeUpdate();
               return rowsInserted > 0;
           }
       }

       // L·∫•y t·∫•t c·∫£ sinh vi√™n
       public List<Student> getAllStudents() throws SQLException {
           List<Student> students = new ArrayList<>();
           String sql = "SELECT id, student_id, name, birth_date, email, phone FROM students";

           try (Statement stmt = conn.createStatement();
                ResultSet rs = stmt.executeQuery(sql)) {

               while (rs.next()) {
                   Student student = new Student();
                   student.setId(rs.getInt("id"));
                   student.setStudentId(rs.getString("student_id"));
                   student.setName(rs.getString("name"));
                   student.setBirthDate(rs.getDate("birth_date"));
                   student.setEmail(rs.getString("email"));
                   student.setPhone(rs.getString("phone"));

                   students.add(student);
               }
           }

           return students;
       }

       // T√¨m sinh vi√™n theo m√£
       public Student findByStudentId(String studentId) throws SQLException {
           String sql = "SELECT id, student_id, name, birth_date, email, phone " +
                       "FROM students WHERE student_id = ?";

           try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
               pstmt.setString(1, studentId);

               try (ResultSet rs = pstmt.executeQuery()) {
                   if (rs.next()) {
                       Student student = new Student();
                       student.setId(rs.getInt("id"));
                       student.setStudentId(rs.getString("student_id"));
                       student.setName(rs.getString("name"));
                       student.setBirthDate(rs.getDate("birth_date"));
                       student.setEmail(rs.getString("email"));
                       student.setPhone(rs.getString("phone"));

                       return student;
                   }
               }
           }

           return null; // Kh√¥ng t√¨m th·∫•y
       }

       // C·∫≠p nh·∫≠t th√¥ng tin sinh vi√™n
       public boolean updateStudent(Student student) throws SQLException {
           String sql = "UPDATE students SET name = ?, birth_date = ?, email = ?, phone = ? " +
                       "WHERE student_id = ?";

           try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
               pstmt.setString(1, student.getName());
               pstmt.setDate(2, new java.sql.Date(student.getBirthDate().getTime()));
               pstmt.setString(3, student.getEmail());
               pstmt.setString(4, student.getPhone());
               pstmt.setString(5, student.getStudentId());

               int rowsUpdated = pstmt.executeUpdate();
               return rowsUpdated > 0;
           }
       }

       // X√≥a sinh vi√™n
       public boolean deleteStudent(String studentId) throws SQLException {
           String sql = "DELETE FROM students WHERE student_id = ?";

           try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
               pstmt.setString(1, studentId);

               int rowsDeleted = pstmt.executeUpdate();
               return rowsDeleted > 0;
           }
       }
   }
   ```

4. **L·ªõp Student:**

   ```java
   import java.util.Date;

   public class Student {
       private int id;
       private String studentId;  // M√£ sinh vi√™n
       private String name;
       private Date birthDate;
       private String email;
       private String phone;

       // Constructor m·∫∑c ƒë·ªãnh
       public Student() {
       }

       // Constructor v·ªõi tham s·ªë
       public Student(String studentId, String name, Date birthDate, String email, String phone) {
           this.studentId = studentId;
           this.name = name;
           this.birthDate = birthDate;
           this.email = email;
           this.phone = phone;
       }

       // Getters v√† Setters
       public int getId() {
           return id;
       }

       public void setId(int id) {
           this.id = id;
       }

       public String getStudentId() {
           return studentId;
       }

       public void setStudentId(String studentId) {
           this.studentId = studentId;
       }

       public String getName() {
           return name;
       }

       public void setName(String name) {
           this.name = name;
       }

       public Date getBirthDate() {
           return birthDate;
       }

       public void setBirthDate(Date birthDate) {
           this.birthDate = birthDate;
       }

       public String getEmail() {
           return email;
       }

       public void setEmail(String email) {
           this.email = email;
       }

       public String getPhone() {
           return phone;
       }

       public void setPhone(String phone) {
           this.phone = phone;
       }

       @Override
       public String toString() {
           return "Student [id=" + id + ", studentId=" + studentId + ", name=" + name +
                  ", birthDate=" + birthDate + ", email=" + email + ", phone=" + phone + "]";
       }
   }
   ```

5. **·ª®ng d·ª•ng ho√†n ch·ªânh v·ªõi ƒëa lu·ªìng:**

   ```java
   import java.sql.SQLException;
   import java.text.ParseException;
   import java.text.SimpleDateFormat;
   import java.util.*;
   import java.util.concurrent.ExecutorService;
   import java.util.concurrent.Executors;

   public class StudentManagementApp {
       private static Scanner scanner = new Scanner(System.in);
       private static StudentDAO studentDAO;
       private static ExecutorService executor = Executors.newFixedThreadPool(3);
       private static SimpleDateFormat dateFormat = new SimpleDateFormat("dd/MM/yyyy");

       public static void main(String[] args) {
           try {
               // Kh·ªüi t·∫°o DAO
               studentDAO = new StudentDAO();

               boolean running = true;
               while (running) {
                   displayMenu();
                   int choice = scanner.nextInt();
                   scanner.nextLine(); // ƒê·ªçc newline

                   switch (choice) {
                       case 1:
                           addNewStudent();
                           break;
                       case 2:
                           displayAllStudents();
                           break;
                       case 3:
                           findStudentById();
                           break;
                       case 4:
                           updateStudentInfo();
                           break;
                       case 5:
                           deleteStudentRecord();
                           break;
                       case 6:
                           backupDataToFile();
                           break;
                       case 0:
                           running = false;
                           executor.shutdown();
                           DatabaseConnection.closeConnection();
                           System.out.println("C·∫£m ∆°n b·∫°n ƒë√£ s·ª≠ d·ª•ng ch∆∞∆°ng tr√¨nh!");
                           break;
                       default:
                           System.out.println("L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!");
                   }
               }
           } catch (SQLException e) {
               System.out.println("L·ªói k·∫øt n·ªëi c∆° s·ªü d·ªØ li·ªáu: " + e.getMessage());
           } finally {
               if (executor != null && !executor.isShutdown()) {
                   executor.shutdown();
               }
           }
       }

       private static void displayMenu() {
           System.out.println("\n=== H·ªÜ TH·ªêNG QU·∫¢N L√ù SINH VI√äN ===");
           System.out.println("1. Th√™m sinh vi√™n m·ªõi");
           System.out.println("2. Xem t·∫•t c·∫£ sinh vi√™n");
           System.out.println("3. T√¨m sinh vi√™n theo m√£");
           System.out.println("4. C·∫≠p nh·∫≠t th√¥ng tin sinh vi√™n");
           System.out.println("5. X√≥a sinh vi√™n");
           System.out.println("6. Sao l∆∞u d·ªØ li·ªáu v√†o file");
           System.out.println("0. Tho√°t");
           System.out.print("Ch·ªçn ch·ª©c nƒÉng: ");
       }

       private static void addNewStudent() {
           System.out.println("\n=== TH√äM SINH VI√äN M·ªöI ===");

           try {
               System.out.print("Nh·∫≠p m√£ sinh vi√™n: ");
               String studentId = scanner.nextLine();

               System.out.print("Nh·∫≠p t√™n sinh vi√™n: ");
               String name = scanner.nextLine();

               System.out.print("Nh·∫≠p ng√†y sinh (dd/MM/yyyy): ");
               String birthDateStr = scanner.nextLine();
               Date birthDate = dateFormat.parse(birthDateStr);

               System.out.print("Nh·∫≠p email: ");
               String email = scanner.nextLine();

               System.out.print("Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i: ");
               String phone = scanner.nextLine();

               Student student = new Student(studentId, name, birthDate, email, phone);

               // Th·ª±c hi·ªán th√™m sinh vi√™n trong thread ri√™ng
               executor.submit(() -> {
                   try {
                       boolean success = studentDAO.addStudent(student);
                       if (success) {
                           System.out.println("ƒê√£ th√™m sinh vi√™n th√†nh c√¥ng!");
                       } else {
                           System.out.println("Th√™m sinh vi√™n th·∫•t b·∫°i!");
                       }
                   } catch (SQLException e) {
                       System.out.println("L·ªói: " + e.getMessage());
                   }
               });

           } catch (ParseException e) {
               System.out.println("ƒê·ªãnh d·∫°ng ng√†y kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p theo ƒë·ªãnh d·∫°ng dd/MM/yyyy");
           }
       }

       private static void displayAllStudents() {
           System.out.println("\n=== DANH S√ÅCH SINH VI√äN ===");

           executor.submit(() -> {
               try {
                   List<Student> students = studentDAO.getAllStudents();

                   if (students.isEmpty()) {
                       System.out.println("Kh√¥ng c√≥ sinh vi√™n n√†o trong c∆° s·ªü d·ªØ li·ªáu");
                       return;
                   }

                   System.out.printf("%-10s %-30s %-15s %-25s %-15s\n",
                                  "M√£ SV", "H·ªç v√† t√™n", "Ng√†y sinh", "Email", "S·ªë ƒëi·ªán tho·∫°i");
                   System.out.println("--------------------------------------------------------------------------------------------------------");

                   for (Student student : students) {
                       System.out.printf("%-10s %-30s %-15s %-25s %-15s\n",
                                      student.getStudentId(),
                                      student.getName(),
                                      dateFormat.format(student.getBirthDate()),
                                      student.getEmail(),
                                      student.getPhone());
                   }
               } catch (SQLException e) {
                   System.out.println("L·ªói khi l·∫•y danh s√°ch sinh vi√™n: " + e.getMessage());
               }
           });
       }

       private static void findStudentById() {
           System.out.print("\nNh·∫≠p m√£ sinh vi√™n c·∫ßn t√¨m: ");
           String studentId = scanner.nextLine();

           executor.submit(() -> {
               try {
                   Student student = studentDAO.findByStudentId(studentId);

                   if (student != null) {
                       System.out.println("\n=== TH√îNG TIN SINH VI√äN ===");
                       System.out.println("M√£ sinh vi√™n: " + student.getStudentId());
                       System.out.println("H·ªç v√† t√™n: " + student.getName());
                       System.out.println("Ng√†y sinh: " + dateFormat.format(student.getBirthDate()));
                       System.out.println("Email: " + student.getEmail());
                       System.out.println("S·ªë ƒëi·ªán tho·∫°i: " + student.getPhone());
                   } else {
                       System.out.println("Kh√¥ng t√¨m th·∫•y sinh vi√™n c√≥ m√£ " + studentId);
                   }
               } catch (SQLException e) {
                   System.out.println("L·ªói khi t√¨m sinh vi√™n: " + e.getMessage());
               }
           });
       }

       private static void updateStudentInfo() {
           System.out.print("\nNh·∫≠p m√£ sinh vi√™n c·∫ßn c·∫≠p nh·∫≠t: ");
           String studentId = scanner.nextLine();

           executor.submit(() -> {
               try {
                   Student student = studentDAO.findByStudentId(studentId);

                   if (student != null) {
                       System.out.println("\n=== C·∫¨P NH·∫¨T TH√îNG TIN SINH VI√äN ===");
                       System.out.println("Sinh vi√™n hi·ªán t·∫°i: " + student.getName());

                       System.out.print("Nh·∫≠p t√™n m·ªõi (Enter ƒë·ªÉ gi·ªØ nguy√™n): ");
                       String name = scanner.nextLine();
                       if (!name.isEmpty()) {
                           student.setName(name);
                       }

                       System.out.print("Nh·∫≠p ng√†y sinh m·ªõi (dd/MM/yyyy) (Enter ƒë·ªÉ gi·ªØ nguy√™n): ");
                       String birthDateStr = scanner.nextLine();
                       if (!birthDateStr.isEmpty()) {
                           try {
                               Date birthDate = dateFormat.parse(birthDateStr);
                               student.setBirthDate(birthDate);
                           } catch (ParseException e) {
                               System.out.println("ƒê·ªãnh d·∫°ng ng√†y kh√¥ng h·ª£p l·ªá, gi·ªØ nguy√™n ng√†y sinh c≈©");
                           }
                       }

                       System.out.print("Nh·∫≠p email m·ªõi (Enter ƒë·ªÉ gi·ªØ nguy√™n): ");
                       String email = scanner.nextLine();
                       if (!email.isEmpty()) {
                           student.setEmail(email);
                       }

                       System.out.print("Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i m·ªõi (Enter ƒë·ªÉ gi·ªØ nguy√™n): ");
                       String phone = scanner.nextLine();
                       if (!phone.isEmpty()) {
                           student.setPhone(phone);
                       }

                       boolean success = studentDAO.updateStudent(student);
                       if (success) {
                           System.out.println("C·∫≠p nh·∫≠t th√¥ng tin sinh vi√™n th√†nh c√¥ng!");
                       } else {
                           System.out.println("C·∫≠p nh·∫≠t th√¥ng tin sinh vi√™n th·∫•t b·∫°i!");
                       }
                   } else {
                       System.out.println("Kh√¥ng t√¨m th·∫•y sinh vi√™n c√≥ m√£ " + studentId);
                   }
               } catch (SQLException e) {
                   System.out.println("L·ªói khi c·∫≠p nh·∫≠t th√¥ng tin sinh vi√™n: " + e.getMessage());
               }
           });
       }

       private static void deleteStudentRecord() {
           System.out.print("\nNh·∫≠p m√£ sinh vi√™n c·∫ßn x√≥a: ");
           String studentId = scanner.nextLine();

           System.out.print("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a sinh vi√™n n√†y? (y/n): ");
           String confirm = scanner.nextLine();

           if (confirm.equalsIgnoreCase("y")) {
               executor.submit(() -> {
                   try {
                       boolean success = studentDAO.deleteStudent(studentId);
                       if (success) {
                           System.out.println("ƒê√£ x√≥a sinh vi√™n th√†nh c√¥ng!");
                       } else {
                           System.out.println("Kh√¥ng t√¨m th·∫•y sinh vi√™n c√≥ m√£ " + studentId);
                       }
                   } catch (SQLException e) {
                       System.out.println("L·ªói khi x√≥a sinh vi√™n: " + e.getMessage());
                   }
               });
           } else {
               System.out.println("ƒê√£ h·ªßy thao t√°c x√≥a");
           }
       }

       private static void backupDataToFile() {
           System.out.println("\n=== SAO L∆ØU D·ªÆ LI·ªÜU ===");
           System.out.print("Nh·∫≠p ƒë∆∞·ªùng d·∫´n file ƒë·ªÉ l∆∞u: ");
           String filePath = scanner.nextLine();

           executor.submit(() -> {
               try {
                   List<Student> students = studentDAO.getAllStudents();

                   // T·∫°o m·ªôt thread kh√°c ƒë·ªÉ ghi file
                   Runnable backupTask = () -> {
                       try (java.io.PrintWriter writer = new java.io.PrintWriter(new java.io.FileWriter(filePath))) {
                           writer.println("M√£ SV,H·ªç v√† t√™n,Ng√†y sinh,Email,S·ªë ƒëi·ªán tho·∫°i");

                           for (Student student : students) {
                               writer.printf("%s,%s,%s,%s,%s\n",
                                          student.getStudentId(),
                                          student.getName(),
                                          dateFormat.format(student.getBirthDate()),
                                          student.getEmail(),
                                          student.getPhone());
                           }

                           System.out.println("ƒê√£ sao l∆∞u d·ªØ li·ªáu th√†nh c√¥ng v√†o file: " + filePath);
                       } catch (java.io.IOException e) {
                           System.out.println("L·ªói khi ghi file: " + e.getMessage());
                       }
                   };

                   // S·ª≠ d·ª•ng executor ƒë·ªÉ th·ª±c hi·ªán c√¥ng vi·ªác sao l∆∞u
                   executor.submit(backupTask);

               } catch (SQLException e) {
                   System.out.println("L·ªói khi l·∫•y d·ªØ li·ªáu ƒë·ªÉ sao l∆∞u: " + e.getMessage());
               }
           });
       }
   }
   ```

---

## üß™ B√ÄI T·∫¨P L·ªöN CU·ªêI PH·∫¶N

### **ƒê·ªÅ b√†i: H·ªá th·ªëng qu·∫£n l√Ω sinh vi√™n v·ªõi c∆° s·ªü d·ªØ li·ªáu**

X√¢y d·ª±ng ·ª©ng d·ª•ng Java v·ªõi c√°c ch·ª©c nƒÉng:

- K·∫øt n·ªëi ƒë·∫øn c∆° s·ªü d·ªØ li·ªáu (MySQL ho·∫∑c SQLite).
- Cho ph√©p:
  - Th√™m sinh vi√™n (m√£, t√™n, ng√†y sinh, email).
  - Xem danh s√°ch sinh vi√™n.
  - S·ª≠a, x√≥a sinh vi√™n.
  - T√¨m sinh vi√™n theo t√™n ho·∫∑c m√£.
- Giao di·ªán d√≤ng l·ªánh, menu t√πy ch·ªçn.

Y√™u c·∫ßu:

- S·ª≠ d·ª•ng JDBC ƒë·ªÉ thao t√°c d·ªØ li·ªáu.
- X·ª≠ l√Ω ƒëa lu·ªìng khi ƒë·ªçc/ghi d·ªØ li·ªáu t·ª´/ƒë·∫øn file backup song song v·ªõi thao t√°c ng∆∞·ªùi d√πng.
- ƒê·∫£m b·∫£o d·ªØ li·ªáu kh√¥ng b·ªã xung ƒë·ªôt khi c√≥ nhi·ªÅu thao t√°c ƒë·ªìng th·ªùi.

---

[‚¨ÖÔ∏è Tr·ªü l·∫°i: JAVA/Part4.md](../JAVA/Part4.md) |
[üè† Home](../README.md) |
[‚û°Ô∏è Ti·∫øp theo: SQL/Part1.md](../SQL/Part1.md)
