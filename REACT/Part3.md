# üìò PH·∫¶N 3: V√íNG ƒê·ªúI, SIDE EFFECTS V√Ä HOOKS CHUY√äN S√ÇU

- [üìò PH·∫¶N 3: V√íNG ƒê·ªúI, SIDE EFFECTS V√Ä HOOKS CHUY√äN S√ÇU](#-ph·∫ßn-3-v√≤ng-ƒë·ªùi-side-effects-v√†-hooks-chuy√™n-s√¢u)
  - [üéØ M·ª•c ti√™u t·ªïng qu√°t](#-m·ª•c-ti√™u-t·ªïng-qu√°t)
  - [üßë‚Äçüè´ B√†i 1: Side Effects v√† Hook `useEffect`](#-b√†i-1-side-effects-v√†-hook-useeffect)
    - [Side Effect l√† g√¨?](#side-effect-l√†-g√¨)
    - [C√∫ ph√°p c∆° b·∫£n c·ªßa `useEffect`](#c√∫-ph√°p-c∆°-b·∫£n-c·ªßa-useeffect)
  - [üßë‚Äçüè´ B√†i 2: M·∫£ng ph·ª• thu·ªôc (Dependency Array) trong `useEffect`](#-b√†i-2-m·∫£ng-ph·ª•-thu·ªôc-dependency-array-trong-useeffect)
    - [Tr∆∞·ªùng h·ª£p 1: Kh√¥ng c√≥ m·∫£ng ph·ª• thu·ªôc](#tr∆∞·ªùng-h·ª£p-1-kh√¥ng-c√≥-m·∫£ng-ph·ª•-thu·ªôc)
    - [Tr∆∞·ªùng h·ª£p 2: M·∫£ng r·ªóng `[]`](#tr∆∞·ªùng-h·ª£p-2-m·∫£ng-r·ªóng-)
    - [Tr∆∞·ªùng h·ª£p 3: M·∫£ng c√≥ gi√° tr·ªã `[prop, state]`](#tr∆∞·ªùng-h·ª£p-3-m·∫£ng-c√≥-gi√°-tr·ªã-prop-state)
  - [üßë‚Äçüè´ B√†i 3: L·∫•y d·ªØ li·ªáu t·ª´ API (Data Fetching)](#-b√†i-3-l·∫•y-d·ªØ-li·ªáu-t·ª´-api-data-fetching)
    - [Quy tr√¨nh l·∫•y d·ªØ li·ªáu](#quy-tr√¨nh-l·∫•y-d·ªØ-li·ªáu)
    - [V√≠ d·ª• ho√†n ch·ªânh](#v√≠-d·ª•-ho√†n-ch·ªânh)
  - [üßë‚Äçüè´ B√†i 4: H√†m d·ªçn d·∫πp (Cleanup Function)](#-b√†i-4-h√†m-d·ªçn-d·∫πp-cleanup-function)
    - [T·∫°i sao c·∫ßn cleanup?](#t·∫°i-sao-c·∫ßn-cleanup)
    - [C√°ch ho·∫°t ƒë·ªông](#c√°ch-ho·∫°t-ƒë·ªông)
  - [üßë‚Äçüè´ B√†i 5: C·∫©m nang React Hooks Chuy√™n s√¢u](#-b√†i-5-c·∫©m-nang-react-hooks-chuy√™n-s√¢u)
    - [Nh√≥m 1: Hooks C∆° b·∫£n (State \& Effects)](#nh√≥m-1-hooks-c∆°-b·∫£n-state--effects)
    - [Nh√≥m 2: Hooks v·ªÅ Context](#nh√≥m-2-hooks-v·ªÅ-context)
    - [Nh√≥m 3: Hooks v·ªÅ T·ªëi ∆∞u h√≥a Hi·ªáu nƒÉng (Performance)](#nh√≥m-3-hooks-v·ªÅ-t·ªëi-∆∞u-h√≥a-hi·ªáu-nƒÉng-performance)
    - [Nh√≥m 4: Hooks v·ªÅ Ref](#nh√≥m-4-hooks-v·ªÅ-ref)
    - [Nh√≥m 5: Hooks N√¢ng cao \& √çt d√πng h∆°n](#nh√≥m-5-hooks-n√¢ng-cao--√≠t-d√πng-h∆°n)
    - [Nh√≥m 6: Hooks m·ªõi trong React 18+](#nh√≥m-6-hooks-m·ªõi-trong-react-18)
  - [üß™ B√ÄI T·∫¨P L·ªöN CU·ªêI PH·∫¶N: L·∫•y d·ªØ li·ªáu s·∫£n ph·∫©m ƒë·ªông cho "SimpleStore"](#-b√†i-t·∫≠p-l·ªõn-cu·ªëi-ph·∫ßn-l·∫•y-d·ªØ-li·ªáu-s·∫£n-ph·∫©m-ƒë·ªông-cho-simplestore)
    - [M√¥ t·∫£ b√†i to√°n](#m√¥-t·∫£-b√†i-to√°n)
    - [Y√™u c·∫ßu](#y√™u-c·∫ßu)

## üéØ M·ª•c ti√™u t·ªïng qu√°t

- Hi·ªÉu r√µ kh√°i ni·ªám "side effect" v√† vai tr√≤ c·ªßa `useEffect`.
- N·∫Øm v·ªØng c√°ch d√πng `useEffect` ƒë·ªÉ l·∫•y d·ªØ li·ªáu t·ª´ API v√† x·ª≠ l√Ω c√°c tr·∫°ng th√°i.
- Hi·ªÉu s√¢u s·∫Øc v√† ph√¢n bi·ªát ƒë∆∞·ª£c c√°ch s·ª≠ d·ª•ng c·ªßa h·∫ßu h·∫øt c√°c Hooks trong React.
- N·∫Øm v·ªØng c√°c Hook d√πng ƒë·ªÉ t·ªëi ∆∞u h√≥a hi·ªáu nƒÉng v√† gi·∫£i quy·∫øt c√°c b√†i to√°n ph·ª©c t·∫°p.
- C·∫≠p nh·∫≠t ki·∫øn th·ª©c v·ªÅ c√°c Hook m·ªõi nh·∫•t ƒë∆∞·ª£c gi·ªõi thi·ªáu trong React 18.

---

## üßë‚Äçüè´ B√†i 1: Side Effects v√† Hook `useEffect`

### Side Effect l√† g√¨?

Trong React, c√°c component c√≥ nhi·ªám v·ª• ch√≠nh l√† render UI d·ª±a tr√™n `props` v√† `state`. B·∫•t k·ª≥ h√†nh ƒë·ªông n√†o kh√¥ng li√™n quan tr·ª±c ti·∫øp ƒë·∫øn vi·ªác render UI ƒë∆∞·ª£c g·ªçi l√† **Side Effect**.

**V√≠ d·ª• v·ªÅ c√°c Side Effects:**
- L·∫•y d·ªØ li·ªáu t·ª´ m·ªôt API b√™n ngo√†i.
- C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ c·ªßa trang (`document.title`).
- Thi·∫øt l·∫≠p v√† h·ªßy c√°c b·ªô ƒë·∫øm th·ªùi gian (`setTimeout`, `setInterval`).
- T∆∞∆°ng t√°c tr·ª±c ti·∫øp v·ªõi DOM.

`useEffect` l√† Hook cho ph√©p b·∫°n th·ª±c thi c√°c side effects t·ª´ b√™n trong function components.

### C√∫ ph√°p c∆° b·∫£n c·ªßa `useEffect`

```jsx
import { useEffect } from 'react';

useEffect(() => {
  // H√†m n√†y ch·ª©a m√£ c·ªßa side effect
}, [dependencies]); // M·∫£ng ph·ª• thu·ªôc
```
S∆° ƒë·ªì m√¥ ph·ªèng:
```
[ Component Render ] ---> [ useEffect ch·∫°y ] ---> [ Th·ª±c thi Side Effect (v√≠ d·ª•: g·ªçi API) ]
```

---

## üßë‚Äçüè´ B√†i 2: M·∫£ng ph·ª• thu·ªôc (Dependency Array) trong `useEffect`

M·∫£ng ph·ª• thu·ªôc quy·∫øt ƒë·ªãnh **khi n√†o** effect s·∫Ω ƒë∆∞·ª£c ch·∫°y l·∫°i.

### Tr∆∞·ªùng h·ª£p 1: Kh√¥ng c√≥ m·∫£ng ph·ª• thu·ªôc
Effect s·∫Ω ch·∫°y **sau m·ªói l·∫ßn render**. R·∫•t √≠t d√πng v√† c·∫ßn c·∫©n th·∫≠n ƒë·ªÉ tr√°nh v√≤ng l·∫∑p v√¥ h·∫°n.

### Tr∆∞·ªùng h·ª£p 2: M·∫£ng r·ªóng `[]`
Effect ch·ªâ ch·∫°y **m·ªôt l·∫ßn duy nh·∫•t** sau l·∫ßn render ƒë·∫ßu ti√™n. ƒê√¢y l√† tr∆∞·ªùng h·ª£p ph·ªï bi·∫øn nh·∫•t ƒë·ªÉ g·ªçi API l·∫•y d·ªØ li·ªáu ban ƒë·∫ßu.

### Tr∆∞·ªùng h·ª£p 3: M·∫£ng c√≥ gi√° tr·ªã `[prop, state]`
Effect s·∫Ω ch·∫°y l·∫ßn ƒë·∫ßu, v√† **ch·∫°y l·∫°i m·ªói khi** b·∫•t k·ª≥ gi√° tr·ªã n√†o trong m·∫£ng ph·ª• thu·ªôc thay ƒë·ªïi.

---

## üßë‚Äçüè´ B√†i 3: L·∫•y d·ªØ li·ªáu t·ª´ API (Data Fetching)

ƒê√¢y l√† ·ª©ng d·ª•ng quan tr·ªçng nh·∫•t c·ªßa `useEffect`. Ch√∫ng ta c·∫ßn qu·∫£n l√Ω 3 tr·∫°ng th√°i: d·ªØ li·ªáu, tr·∫°ng th√°i t·∫£i, v√† l·ªói.

### Quy tr√¨nh l·∫•y d·ªØ li·ªáu
1.  **Kh·ªüi t·∫°o states**: `useState` cho `data`, `loading`, `error`.
2.  **G·ªçi `useEffect`**: V·ªõi m·∫£ng ph·ª• thu·ªôc `[]` ƒë·ªÉ ch·ªâ ch·∫°y m·ªôt l·∫ßn.
3.  **B√™n trong `useEffect`**:
    -   ƒê·∫∑t `loading` th√†nh `true`.
    -   D√πng `fetch` trong kh·ªëi `try...catch`.
    -   `try`: N·∫øu th√†nh c√¥ng, c·∫≠p nh·∫≠t state `data`, ƒë·∫∑t `loading` th√†nh `false`.
    -   `catch`: N·∫øu th·∫•t b·∫°i, c·∫≠p nh·∫≠t state `error`, ƒë·∫∑t `loading` th√†nh `false`.

### V√≠ d·ª• ho√†n ch·ªânh
```jsx
import { useState, useEffect } from 'react';

function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchData = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await fetch(`https://jsonplaceholder.typicode.com/users/${userId}`);
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        setUser(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };
    fetchData();
  }, [userId]);

  if (loading) return <p>ƒêang t·∫£i...</p>;
  if (error) return <p>L·ªói: {error}</p>;

  return <div><h1>{user?.name}</h1><p>Email: {user?.email}</p></div>;
}
```

---

## üßë‚Äçüè´ B√†i 4: H√†m d·ªçn d·∫πp (Cleanup Function)

### T·∫°i sao c·∫ßn cleanup?
M·ªôt s·ªë side effects c·∫ßn ƒë∆∞·ª£c "d·ªçn d·∫πp" khi component b·ªã g·ª° kh·ªèi DOM (unmount) ƒë·ªÉ tr√°nh r√≤ r·ªâ b·ªô nh·ªõ (memory leak). V√≠ d·ª•: h·ªßy timer, g·ª° event listener.

### C√°ch ho·∫°t ƒë·ªông
`useEffect` c√≥ th·ªÉ tr·∫£ v·ªÅ m·ªôt h√†m. H√†m n√†y s·∫Ω ƒë∆∞·ª£c React g·ªçi khi component s·∫Øp b·ªã unmount ho·∫∑c tr∆∞·ªõc khi effect ch·∫°y l·∫°i.

```jsx
useEffect(() => {
  const timerId = setInterval(() => console.log('Tick'), 1000);
  // H√†m cleanup
  return () => clearInterval(timerId);
}, []);
```

---

## üßë‚Äçüè´ B√†i 5: C·∫©m nang React Hooks Chuy√™n s√¢u

Ph·∫ßn n√†y s·∫Ω ƒëi s√¢u v√†o to√†n b·ªô c√°c Hooks quan tr·ªçng trong React, ph√¢n lo·∫°i theo ch·ª©c nƒÉng ƒë·ªÉ b·∫°n d·ªÖ d√†ng tham kh·∫£o v√† n·∫Øm v·ªØng.

### Nh√≥m 1: Hooks C∆° b·∫£n (State & Effects)
- **`useState`**: Hook c∆° b·∫£n nh·∫•t, cho ph√©p function component c√≥ state ri√™ng.
- **`useEffect`**: Hook ƒë·ªÉ th·ª±c thi c√°c "side effect" nh∆∞ ƒë√£ tr√¨nh b√†y ·ªü tr√™n.

### Nh√≥m 2: Hooks v·ªÅ Context
- **`useContext`**: Cho ph√©p component ƒë·ªçc gi√° tr·ªã t·ª´ m·ªôt React Context m√† kh√¥ng c·∫ßn prop drilling (truy·ªÅn props qua nhi·ªÅu c·∫•p). R·∫•t h·ªØu √≠ch ƒë·ªÉ chia s·∫ª d·ªØ li·ªáu "to√†n c·ª•c" nh∆∞ theme, ng√¥n ng·ªØ, th√¥ng tin ng∆∞·ªùi d√πng.

```jsx
// 1. T·∫°o Context:
// const ThemeContext = createContext('light');

// 2. Cung c·∫•p Context trong component cha:
// <ThemeContext.Provider value={theme}>...</ThemeContext.Provider>

// 3. S·ª≠ d·ª•ng Context trong component con:
// const theme = useContext(ThemeContext);
```

### Nh√≥m 3: Hooks v·ªÅ T·ªëi ∆∞u h√≥a Hi·ªáu nƒÉng (Performance)
- **`useMemo`**: Ghi nh·ªõ (memoize) **k·∫øt qu·∫£** c·ªßa m·ªôt ph√©p t√≠nh t·ªën k√©m, ch·ªâ t√≠nh l·∫°i khi ph·ª• thu·ªôc thay ƒë·ªïi. D√πng cho vi·ªác l·ªçc/s·∫Øp x·∫øp danh s√°ch l·ªõn.
  ```jsx
  const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);
  ```

- **`useCallback`**: Ghi nh·ªõ (memoize) m·ªôt **ƒë·ªãnh nghƒ©a h√†m**, gi√∫p n√≥ kh√¥ng b·ªã t·∫°o l·∫°i tr√™n m·ªói l·∫ßn render. R·∫•t quan tr·ªçng khi truy·ªÅn h√†m xu·ªëng c√°c component con ƒë√£ ƒë∆∞·ª£c t·ªëi ∆∞u b·∫±ng `React.memo`.
  ```jsx
  const memoizedCallback = useCallback(() => { doSomething(a, b); }, [a, b]);
  ```
- **`React.memo`**: M·ªôt Higher-Order Component (HOC), kh√¥ng ph·∫£i Hook. N√≥ b·ªçc m·ªôt component v√† ngƒÉn component ƒë√≥ re-render n·∫øu c√°c `props` c·ªßa n√≥ kh√¥ng thay ƒë·ªïi.

### Nh√≥m 4: Hooks v·ªÅ Ref
- **`useRef`**: T·∫°o ra m·ªôt object `{ current: ... }` t·ªìn t·∫°i trong su·ªët v√≤ng ƒë·ªùi c·ªßa component.
    1.  **Truy c·∫≠p DOM**: `<input ref={myRef} />` ƒë·ªÉ c√≥ th·ªÉ g·ªçi `myRef.current.focus()`.
    2.  **L∆∞u tr·ªØ gi√° tr·ªã**: D√πng ƒë·ªÉ l∆∞u m·ªôt bi·∫øn m√† kh√¥ng g√¢y re-render khi thay ƒë·ªïi (v√≠ d·ª•: timer ID).

- **`forwardRef`**: HOC cho ph√©p component nh·∫≠n `ref` v√† "chuy·ªÉn ti·∫øp" n√≥ xu·ªëng m·ªôt ph·∫ßn t·ª≠ con.
- **`useImperativeHandle`**: D√πng chung v·ªõi `forwardRef` ƒë·ªÉ t√πy ch·ªânh "API" m√† ref ph∆°i ra cho component cha, thay v√¨ ph∆°i ra to√†n b·ªô DOM node.

```jsx
// MyInput.js
const MyInput = forwardRef((props, ref) => {
  const inputRef = useRef();
  useImperativeHandle(ref, () => ({
    focus: () => { inputRef.current.focus(); } // Ch·ªâ ph∆°i ra h√†m focus
  }));
  return <input ref={inputRef} {...props} />;
});
```

### Nh√≥m 5: Hooks N√¢ng cao & √çt d√πng h∆°n
- **`useReducer`**: M·ªôt l·ª±a ch·ªçn thay th·∫ø cho `useState` ƒë·ªÉ qu·∫£n l√Ω state ph·ª©c t·∫°p, gi√∫p t√°ch bi·ªát logic c·∫≠p nh·∫≠t state ra kh·ªèi component.
  ```jsx
  const [state, dispatch] = useReducer(reducer, initialState);
  ```
- **`useLayoutEffect`**: Gi·ªëng h·ªát `useEffect` v·ªÅ c√∫ ph√°p, nh∆∞ng ch·∫°y **ƒë·ªìng b·ªô** sau khi DOM thay ƒë·ªïi v√† *tr∆∞·ªõc khi* tr√¨nh duy·ªát v·∫Ω l√™n m√†n h√¨nh. D√πng ƒë·ªÉ ƒë·ªçc layout DOM v√† thay ƒë·ªïi n√≥ ngay l·∫≠p t·ª©c ƒë·ªÉ tr√°nh hi·ªán t∆∞·ª£ng "nh·∫•p nh√°y".

### Nh√≥m 6: Hooks m·ªõi trong React 18+
- **`useId`**: T·∫°o ra m·ªôt ID duy nh·∫•t v√† ·ªïn ƒë·ªãnh tr√™n c·∫£ server v√† client, gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ hydration mismatch trong Server-Side Rendering (SSR).
  ```jsx
  const id = useId();
  return <><label htmlFor={id}>...</label><input id={id} /></>;
  ```
- **`useTransition`**: ƒê√°nh d·∫•u m·ªôt c·∫≠p nh·∫≠t state l√† "kh√¥ng kh·∫©n c·∫•p" (transition), gi√∫p UI lu√¥n ph·∫£n h·ªìi trong khi c√°c re-render ch·∫≠m ƒëang di·ªÖn ra.
  ```jsx
  const [isPending, startTransition] = useTransition();
  //...
  startTransition(() => {
    // C·∫≠p nh·∫≠t state g√¢y re-render ch·∫≠m ·ªü ƒë√¢y
  });
  ```
- **`useDeferredValue`**: Tr√¨ ho√£n vi·ªác c·∫≠p nh·∫≠t m·ªôt gi√° tr·ªã. M·ªôt c√°ch ti·∫øp c·∫≠n ƒë∆°n gi·∫£n h∆°n `useTransition` ƒë·ªÉ gi·ªØ cho UI m∆∞·ª£t m√† khi m·ªôt gi√° tr·ªã n√†o ƒë√≥ g√¢y ra re-render ch·∫≠m.
  ```jsx
  const deferredQuery = useDeferredValue(query);
  // D√πng `deferredQuery` cho component render ch·∫≠m.
  ```

---

## üß™ B√ÄI T·∫¨P L·ªöN CU·ªêI PH·∫¶N: L·∫•y d·ªØ li·ªáu s·∫£n ph·∫©m ƒë·ªông cho "SimpleStore"

### M√¥ t·∫£ b√†i to√°n
N√¢ng c·∫•p trang "SimpleStore" ƒë·ªÉ kh√¥ng c√≤n s·ª≠ d·ª•ng d·ªØ li·ªáu s·∫£n ph·∫©m c·ª©ng trong code n·ªØa. Thay v√†o ƒë√≥, ch√∫ng ta s·∫Ω l·∫•y danh s√°ch s·∫£n ph·∫©m t·ª´ m·ªôt API c√¥ng khai.

### Y√™u c·∫ßu
1.  **Ch·ªçn API**: S·ª≠ d·ª•ng API mi·ªÖn ph√≠ `https://fakestoreapi.com/products` ƒë·ªÉ l·∫•y danh s√°ch s·∫£n ph·∫©m.
2.  **Qu·∫£n l√Ω State trong `App.jsx`**:
    -   X√≥a m·∫£ng `products` c·ª©ng.
    -   T·∫°o 3 state m·ªõi: `products`, `loading`, `error`.
3.  **S·ª≠ d·ª•ng `useEffect`**:
    -   Trong `App.jsx`, vi·∫øt m·ªôt `useEffect` v·ªõi m·∫£ng ph·ª• thu·ªôc r·ªóng `[]`.
    -   B√™n trong effect, th·ª±c hi·ªán vi·ªác g·ªçi API ƒë·∫øn `https://fakestoreapi.com/products`.
    -   X·ª≠ l√Ω c√°c tr∆∞·ªùng h·ª£p:
        -   Khi b·∫Øt ƒë·∫ßu g·ªçi, `setLoading(true)`.
        -   N·∫øu g·ªçi th√†nh c√¥ng, `setProducts(data)` v·ªõi d·ªØ li·ªáu nh·∫≠n v·ªÅ.
        -   N·∫øu c√≥ l·ªói, `setError(errorMessage)`.
        -   Cu·ªëi c√πng, d√π th√†nh c√¥ng hay th·∫•t b·∫°i, `setLoading(false)`.
4.  **Render c√≥ ƒëi·ªÅu ki·ªán**:
    -   Trong ph·∫ßn JSX c·ªßa `App.jsx`, hi·ªÉn th·ªã giao di·ªán d·ª±a tr√™n c√°c state tr√™n:
        -   N·∫øu `loading` l√† `true`, hi·ªÉn th·ªã m·ªôt th√¥ng b√°o nh∆∞ `<div>ƒêang t·∫£i s·∫£n ph·∫©m...</div>`.
        -   N·∫øu `error` c√≥ gi√° tr·ªã, hi·ªÉn th·ªã th√¥ng b√°o l·ªói: `<div>ƒê√£ x·∫£y ra l·ªói: {error}</div>`.
        -   N·∫øu kh√¥ng loading v√† kh√¥ng c√≥ l·ªói, render component `ProductList` v√† truy·ªÅn `products` ƒë√£ l·∫•y ƒë∆∞·ª£c v√†o.
5.  **C·∫≠p nh·∫≠t `ProductCard`**:
    -   ƒê·∫£m b·∫£o `ProductCard` c·ªßa b·∫°n nh·∫≠n c√°c props ph√π h·ª£p v·ªõi d·ªØ li·ªáu t·ª´ API (`title`, `price`, `image`).

**M·ª•c ti√™u:** K·∫øt th√∫c ph·∫ßn n√†y, "SimpleStore" s·∫Ω tr·ªü th√†nh m·ªôt ·ª©ng d·ª•ng web ƒë·ªông th·ª±c s·ª±, c√≥ kh·∫£ nƒÉng l·∫•y v√† hi·ªÉn th·ªã d·ªØ li·ªáu t·ª´ internet, ƒë·ªìng th·ªùi x·ª≠ l√Ω c√°c tr·∫°ng th√°i t·∫£i v√† l·ªói m·ªôt c√°ch chuy√™n nghi·ªáp.
